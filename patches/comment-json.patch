# Fix comment-json whitespace formatting for multi-line block comments
#
# This patch addresses two formatting issues in the comment-json library:
# 1. Multi-line comments need proper indentation on each line
# 2. Block comments at the beginning of objects need proper formatting
#
# Without this patch, multi-line block comments would have inconsistent
# indentation and the header comment would be directly followed by the
# opening brace instead of having a proper line break.
#
# This ensures generated wrangler.json files have properly formatted
# comments that match the expected snapshot test output.

diff --git a/src/stringify.js b/src/stringify.js
index 083b83875d8efcc5fc3e1b22e96ee1d46d55034a..f587372508ec60931c2ae81b5f0b2d2f080bccbe 100644
--- a/src/stringify.js
+++ b/src/stringify.js
@@ -92,6 +92,7 @@ const process_comments = (host, symbol_tag, deeper_gap, display_block) => {
       : LF + deeper_gap
 
     is_line_comment = type === 'LineComment'
+		value = value.split(LF).join(LF + deeper_gap)
 
     return prev + delimiter + comment_stringify(value, is_line_comment)
   }, EMPTY)
@@ -359,7 +360,7 @@ module.exports = (value, replacer_, space) => {
   clean()
 
   return isObject(value)
-    ? process_comments(value, PREFIX_BEFORE_ALL, EMPTY).trimLeft()
+    ? process_comments(value, PREFIX_BEFORE_ALL, EMPTY, true).trimLeft()
       + str
       + process_comments(value, PREFIX_AFTER_ALL, EMPTY).trimRight()
     : str
