// Hybrid polyfill for `node:fs`
// Needed as a few symbols are missing from the native implementation

// Missing from workerd native `fs` implementation
import {
	F_OK,
	FileReadStream,
	FileWriteStream,
	openAsBlob,
	R_OK,
	W_OK,
	X_OK,
} from "unenv/node/fs";
import type nodeFs from "node:fs";

// Export unenv symbols
export {
	FileReadStream,
	FileWriteStream,
	openAsBlob,
	F_OK,
	R_OK,
	W_OK,
	X_OK,
} from "unenv/node/fs";

const workerdFs = process.getBuiltinModule("node:fs");

const {
	access,
	accessSync,
	appendFile,
	appendFileSync,
	chmod,
	chmodSync,
	chown,
	chownSync,
	close,
	closeSync,
	constants,
	copyFile,
	copyFileSync,
	cp,
	cpSync,
	createReadStream,
	createWriteStream,
	Dir,
	Dirent,
	exists,
	existsSync,
	fchmod,
	fchmodSync,
	fchown,
	fchownSync,
	fdatasync,
	fdatasyncSync,
	fstat,
	fstatSync,
	fsync,
	fsyncSync,
	ftruncate,
	ftruncateSync,
	futimes,
	futimesSync,
	glob,
	globSync,
	lchmod,
	lchmodSync,
	lchown,
	lchownSync,
	link,
	linkSync,
	lstat,
	lstatSync,
	lutimes,
	lutimesSync,
	mkdir,
	mkdirSync,
	mkdtemp,
	mkdtempSync,
	open,
	opendir,
	opendirSync,
	openSync,
	promises,
	read,
	readdir,
	readdirSync,
	readFile,
	readFileSync,
	readlink,
	readlinkSync,
	ReadStream,
	readSync,
	readv,
	readvSync,
	realpath,
	realpathSync,
	rename,
	renameSync,
	rm,
	rmdir,
	rmdirSync,
	rmSync,
	stat,
	statfs,
	statfsSync,
	Stats,
	statSync,
	symlink,
	symlinkSync,
	truncate,
	truncateSync,
	unlink,
	unlinkSync,
	unwatchFile,
	utimes,
	utimesSync,
	watch,
	watchFile,
	write,
	writeFile,
	writeFileSync,
	WriteStream,
	writeSync,
	writev,
	writevSync,
} = workerdFs;

// Export native symbols
export {
	access,
	accessSync,
	appendFile,
	appendFileSync,
	chmod,
	chmodSync,
	chown,
	chownSync,
	close,
	closeSync,
	constants,
	copyFile,
	copyFileSync,
	cp,
	cpSync,
	createReadStream,
	createWriteStream,
	Dir,
	Dirent,
	exists,
	existsSync,
	fchmod,
	fchmodSync,
	fchown,
	fchownSync,
	fdatasync,
	fdatasyncSync,
	fstat,
	fstatSync,
	fsync,
	fsyncSync,
	ftruncate,
	ftruncateSync,
	futimes,
	futimesSync,
	glob,
	globSync,
	lchmod,
	lchmodSync,
	lchown,
	lchownSync,
	link,
	linkSync,
	lstat,
	lstatSync,
	lutimes,
	lutimesSync,
	mkdir,
	mkdirSync,
	mkdtemp,
	mkdtempSync,
	open,
	opendir,
	opendirSync,
	openSync,
	promises,
	read,
	readdir,
	readdirSync,
	readFile,
	readFileSync,
	readlink,
	readlinkSync,
	ReadStream,
	readSync,
	readv,
	readvSync,
	realpath,
	realpathSync,
	rename,
	renameSync,
	rm,
	rmdir,
	rmdirSync,
	rmSync,
	stat,
	statfs,
	statfsSync,
	Stats,
	statSync,
	symlink,
	symlinkSync,
	truncate,
	truncateSync,
	unlink,
	unlinkSync,
	unwatchFile,
	utimes,
	utimesSync,
	watch,
	watchFile,
	write,
	writeFile,
	writeFileSync,
	WriteStream,
	writeSync,
	writev,
	writevSync,
};

export default {
	// unenv
	// @ts-expect-error Not in Node types
	FileReadStream,
	FileWriteStream,
	openAsBlob,
	F_OK,
	R_OK,
	W_OK,
	X_OK,

	// workerd
	access,
	accessSync,
	appendFile,
	appendFileSync,
	chmod,
	chmodSync,
	chown,
	chownSync,
	close,
	closeSync,
	constants,
	copyFile,
	copyFileSync,
	cp,
	cpSync,
	createReadStream,
	createWriteStream,
	Dir,
	Dirent,
	exists,
	existsSync,
	fchmod,
	fchmodSync,
	fchown,
	fchownSync,
	fdatasync,
	fdatasyncSync,
	fstat,
	fstatSync,
	fsync,
	fsyncSync,
	ftruncate,
	ftruncateSync,
	futimes,
	futimesSync,
	glob,
	globSync,
	lchmod,
	lchmodSync,
	lchown,
	lchownSync,
	link,
	linkSync,
	lstat,
	lstatSync,
	lutimes,
	lutimesSync,
	mkdir,
	mkdirSync,
	mkdtemp,
	mkdtempSync,
	open,
	opendir,
	opendirSync,
	openSync,
	promises,
	read,
	readdir,
	readdirSync,
	readFile,
	readFileSync,
	readlink,
	readlinkSync,
	ReadStream,
	readSync,
	readv,
	readvSync,
	realpath,
	realpathSync,
	rename,
	renameSync,
	rm,
	rmdir,
	rmdirSync,
	rmSync,
	stat,
	statfs,
	statfsSync,
	Stats,
	statSync,
	symlink,
	symlinkSync,
	truncate,
	truncateSync,
	unlink,
	unlinkSync,
	unwatchFile,
	utimes,
	utimesSync,
	watch,
	watchFile,
	write,
	writeFile,
	writeFileSync,
	WriteStream,
	writeSync,
	writev,
	writevSync,
} satisfies typeof nodeFs;
