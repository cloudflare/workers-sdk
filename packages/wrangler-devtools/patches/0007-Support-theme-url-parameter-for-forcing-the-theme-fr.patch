From a76c8fc907e033e3f7fc1eb588e742b2dd896e58 Mon Sep 17 00:00:00 2001
From: Samuel Macleod <smacleod@cloudflare.com>
Date: Fri, 20 Jan 2023 19:19:37 +0000
Subject: [PATCH 07/15] Support theme= url parameter for forcing the theme from
 outside

---
 front_end/ui/legacy/theme_support/ThemeSupport.ts | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/front_end/ui/legacy/theme_support/ThemeSupport.ts b/front_end/ui/legacy/theme_support/ThemeSupport.ts
index 87d8a05a43..86f0335ac2 100644
--- a/front_end/ui/legacy/theme_support/ThemeSupport.ts
+++ b/front_end/ui/legacy/theme_support/ThemeSupport.ts
@@ -165,10 +165,13 @@ export class ThemeSupport extends EventTarget {
   }
 
   #applyThemeToDocument(document: Document): void {
+    // Get theme from url, to allow for theme inheritance from the Cloudflare dashboard
+    const urlParams = new URLSearchParams(document.location.search);
+    const theme = urlParams.get('theme') ?? 'systemPreferred';
     const isForcedColorsMode = window.matchMedia('(forced-colors: active)').matches;
     const systemPreferredTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'default';
 
-    const useSystemPreferred = this.setting.get() === 'systemPreferred' || isForcedColorsMode;
+    const useSystemPreferred = theme === 'systemPreferred' || isForcedColorsMode;
     this.themeNameInternal = useSystemPreferred ? systemPreferredTheme : this.setting.get();
     document.documentElement.classList.toggle('theme-with-dark-background', this.themeNameInternal === 'dark');
 
-- 
2.39.5 (Apple Git-154)

