From 8fd0d200e822ddceaf8a581a74d26aae55385f5b Mon Sep 17 00:00:00 2001
From: Samuel Macleod <smacleod@cloudflare.com>
Date: Thu, 19 Jan 2023 15:47:52 +0000
Subject: [PATCH 04/13] Better Firefox support for network tab

---
 front_end/entrypoints/js_app/js_app.ts               | 7 +++----
 front_end/ui/legacy/components/data_grid/DataGrid.ts | 5 +++++
 2 files changed, 8 insertions(+), 4 deletions(-)

diff --git a/front_end/entrypoints/js_app/js_app.ts b/front_end/entrypoints/js_app/js_app.ts
index 2883727e35..0281b38548 100644
--- a/front_end/entrypoints/js_app/js_app.ts
+++ b/front_end/entrypoints/js_app/js_app.ts
@@ -29,10 +29,6 @@ const UIStrings = {
    *@description Title of the 'Scripts' tool in the Network Navigator View, which is part of the Sources tool
    */
   networkTitle: 'Scripts',
-  /**
-   *@description Command for showing the 'Scripts' tool in the Network Navigator View, which is part of the Sources tool
-   */
-  showNode: 'Show Scripts',
 };
 
 const str_ = i18n.i18n.registerUIStrings('entrypoints/js_app/js_app.ts', UIStrings);
@@ -48,6 +44,9 @@ async function loadSourcesModule(): Promise<typeof Sources> {
   }
   return loadedSourcesModule;
 }
+
+// This is not supported in Firefox: https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoView
+Element.prototype.scrollIntoViewIfNeeded = Element.prototype.scrollIntoView;
 export class JsMainImpl implements Common.Runnable.Runnable {
   static instance(opts: {forceNew: boolean|null} = {forceNew: null}): JsMainImpl {
     const {forceNew} = opts;
diff --git a/front_end/ui/legacy/components/data_grid/DataGrid.ts b/front_end/ui/legacy/components/data_grid/DataGrid.ts
index 93a117e746..5c667b6b77 100644
--- a/front_end/ui/legacy/components/data_grid/DataGrid.ts
+++ b/front_end/ui/legacy/components/data_grid/DataGrid.ts
@@ -217,6 +217,8 @@ export class DataGridImpl<T> extends Common.ObjectWrapper.ObjectWrapper<EventTyp
     this.headerRow = this.dataTableHeadInternal.createChild('tr');
 
     this.dataTableBody = this.dataTable.createChild('tbody');
+    // This is required for Firefox, else Firefox will position the <tbody/> *under* the <thead/>
+    (this.dataTableBody as HTMLElement).style.height = "calc(100% - 27px)"
     this.topFillerRow = (this.dataTableBody.createChild('tr', 'data-grid-filler-row revealed') as HTMLElement);
     UI.ARIAUtils.setHidden(this.topFillerRow, true);
     this.bottomFillerRow = (this.dataTableBody.createChild('tr', 'data-grid-filler-row revealed') as HTMLElement);
@@ -505,6 +507,9 @@ export class DataGridImpl<T> extends Common.ObjectWrapper.ObjectWrapper<EventTyp
   protected setVerticalPadding(top: number, bottom: number, isConstructorTime: boolean = false): void {
     const topPx = top + 'px';
     const bottomPx = (top || bottom) ? bottom + 'px' : 'auto';
+    // Firefox isn't happy with 0 height table rows, so hide them instead
+    this.topFillerRow.classList.toggle('revealed', topPx !== '0px');
+    this.bottomFillerRow.classList.toggle('revealed', bottomPx !== '0px');
     if (this.topFillerRow.style.height === topPx && this.bottomFillerRow.style.height === bottomPx) {
       return;
     }
-- 
2.39.5 (Apple Git-154)

