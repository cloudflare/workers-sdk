{"version":3,"file":"TimelineIRModel.js","sourceRoot":"","sources":["../../../../../../front_end/models/timeline_model/TimelineIRModel.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2016 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as SDK from '../../core/sdk/sdk.js';\n\nconst UIStrings = {\n  /**\n  * @description Error text in Timeline IRModel of the Performance panel. Indicates that two fling\n  * gestures were detected at the same time, which should not be possible.\n  *@example {2s} PH1\n  *@example {3s} PH2\n  */\n  twoFlingsAtTheSameTimeSVsS: 'Two flings at the same time? {PH1} vs {PH2}',\n  /**\n  *@description Text in Timeline IRModel of the Performance panel\n  *@example {2s} PH1\n  *@example {3s} PH2\n  */\n  twoTouchesAtTheSameTimeSVsS: 'Two touches at the same time? {PH1} vs {PH2}',\n};\nconst str_ = i18n.i18n.registerUIStrings('models/timeline_model/TimelineIRModel.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nconst eventToPhase = new WeakMap<SDK.TracingModel.Event, Phases>();\n\nexport class TimelineIRModel {\n  private segments!: Common.SegmentedRange.Segment<Phases>[];\n  private drags!: Common.SegmentedRange.SegmentedRange<Phases>;\n  private cssAnimations!: Common.SegmentedRange.SegmentedRange<Phases>;\n  private responses!: Common.SegmentedRange.SegmentedRange<Phases>;\n  private scrolls!: Common.SegmentedRange.SegmentedRange<Phases>;\n\n  constructor() {\n    this.reset();\n  }\n\n  static phaseForEvent(event: SDK.TracingModel.Event): Phases|undefined {\n    return eventToPhase.get(event);\n  }\n\n  populate(inputLatencies: SDK.TracingModel.AsyncEvent[]|null, animations: SDK.TracingModel.AsyncEvent[]|null): void {\n    this.reset();\n    if (!inputLatencies) {\n      return;\n    }\n    this.processInputLatencies(inputLatencies);\n    if (animations) {\n      this.processAnimations(animations);\n    }\n    const range = new Common.SegmentedRange.SegmentedRange<Phases>();\n    range.appendRange(this.drags);  // Drags take lower precedence than animation, as we can't detect them reliably.\n    range.appendRange(this.cssAnimations);\n    range.appendRange(this.scrolls);\n    range.appendRange(this.responses);\n    this.segments = range.segments();\n  }\n\n  private processInputLatencies(events: SDK.TracingModel.AsyncEvent[]): void {\n    const eventTypes = InputEvents;\n    const phases = Phases;\n    const thresholdsMs = TimelineIRModel._mergeThresholdsMs;\n\n    let scrollStart;\n    let flingStart;\n    let touchStart;\n    let firstTouchMove;\n    let mouseWheel;\n    let mouseDown;\n    let mouseMove;\n\n    for (let i = 0; i < events.length; ++i) {\n      const event = events[i];\n      if (i > 0 && events[i].startTime < events[i - 1].startTime) {\n        console.assert(false, 'Unordered input events');\n      }\n      const type = this.inputEventType(event.name);\n      switch (type) {\n        case eventTypes.ScrollBegin:\n          this.scrolls.append(this.segmentForEvent(event, phases.Scroll));\n          scrollStart = event;\n          break;\n\n        case eventTypes.ScrollEnd:\n          if (scrollStart) {\n            this.scrolls.append(this.segmentForEventRange(scrollStart, event, phases.Scroll));\n          } else {\n            this.scrolls.append(this.segmentForEvent(event, phases.Scroll));\n          }\n          scrollStart = null;\n          break;\n\n        case eventTypes.ScrollUpdate:\n          touchStart = null;  // Since we're scrolling now, disregard other touch gestures.\n          this.scrolls.append(this.segmentForEvent(event, phases.Scroll));\n          break;\n\n        case eventTypes.FlingStart:\n          if (flingStart) {\n            Common.Console.Console.instance().error(\n                i18nString(UIStrings.twoFlingsAtTheSameTimeSVsS, {PH1: flingStart.startTime, PH2: event.startTime}));\n            break;\n          }\n          flingStart = event;\n          break;\n\n        case eventTypes.FlingCancel:\n          // FIXME: also process renderer fling events.\n          if (!flingStart) {\n            break;\n          }\n          this.scrolls.append(this.segmentForEventRange(flingStart, event, phases.Fling));\n          flingStart = null;\n          break;\n\n        case eventTypes.ImplSideFling:\n          this.scrolls.append(this.segmentForEvent(event, phases.Fling));\n          break;\n\n        case eventTypes.ShowPress:\n        case eventTypes.Tap:\n        case eventTypes.KeyDown:\n        case eventTypes.KeyDownRaw:\n        case eventTypes.KeyUp:\n        case eventTypes.Char:\n        case eventTypes.Click:\n        case eventTypes.ContextMenu:\n          this.responses.append(this.segmentForEvent(event, phases.Response));\n          break;\n\n        case eventTypes.TouchStart:\n          // We do not produce any response segment for TouchStart -- there's either going to be one upon\n          // TouchMove for drag, or one for GestureTap.\n          if (touchStart) {\n            Common.Console.Console.instance().error(\n                i18nString(UIStrings.twoTouchesAtTheSameTimeSVsS, {PH1: touchStart.startTime, PH2: event.startTime}));\n            break;\n          }\n          touchStart = event;\n          this.setPhaseForEvent(event, phases.Response);\n          firstTouchMove = null;\n          break;\n\n        case eventTypes.TouchCancel:\n          touchStart = null;\n          break;\n\n        case eventTypes.TouchMove:\n          if (firstTouchMove) {\n            this.drags.append(this.segmentForEvent(event, phases.Drag));\n          } else if (touchStart) {\n            firstTouchMove = event;\n            this.responses.append(this.segmentForEventRange(touchStart, event, phases.Response));\n          }\n          break;\n\n        case eventTypes.TouchEnd:\n          touchStart = null;\n          break;\n\n        case eventTypes.MouseDown:\n          mouseDown = event;\n          mouseMove = null;\n          break;\n\n        case eventTypes.MouseMove:\n          if (mouseDown && !mouseMove && mouseDown.startTime + thresholdsMs.mouse > event.startTime) {\n            this.responses.append(this.segmentForEvent(mouseDown, phases.Response));\n            this.responses.append(this.segmentForEvent(event, phases.Response));\n          } else if (mouseDown) {\n            this.drags.append(this.segmentForEvent(event, phases.Drag));\n          }\n          mouseMove = event;\n          break;\n\n        case eventTypes.MouseUp:\n          this.responses.append(this.segmentForEvent(event, phases.Response));\n          mouseDown = null;\n          break;\n\n        case eventTypes.MouseWheel:\n          // Do not consider first MouseWheel as trace viewer's implementation does -- in case of MouseWheel it's not really special.\n          if (mouseWheel && canMerge(thresholdsMs.mouse, mouseWheel, event)) {\n            this.scrolls.append(this.segmentForEventRange(mouseWheel, event, phases.Scroll));\n          } else {\n            this.scrolls.append(this.segmentForEvent(event, phases.Scroll));\n          }\n          mouseWheel = event;\n          break;\n      }\n    }\n\n    function canMerge(\n        threshold: number, first: SDK.TracingModel.AsyncEvent, second: SDK.TracingModel.AsyncEvent): boolean {\n      if (first.endTime === undefined) {\n        return false;\n      }\n      return first.endTime < second.startTime && second.startTime < first.endTime + threshold;\n    }\n  }\n\n  private processAnimations(events: SDK.TracingModel.AsyncEvent[]): void {\n    for (let i = 0; i < events.length; ++i) {\n      this.cssAnimations.append(this.segmentForEvent(events[i], Phases.Animation));\n    }\n  }\n\n  private segmentForEvent(event: SDK.TracingModel.AsyncEvent, phase: Phases): Common.SegmentedRange.Segment<Phases> {\n    this.setPhaseForEvent(event, phase);\n    return new Common.SegmentedRange.Segment<Phases>(\n        event.startTime, event.endTime !== undefined ? event.endTime : Number.MAX_SAFE_INTEGER, phase);\n  }\n\n  private segmentForEventRange(\n      startEvent: SDK.TracingModel.AsyncEvent, endEvent: SDK.TracingModel.AsyncEvent,\n      phase: Phases): Common.SegmentedRange.Segment<Phases> {\n    this.setPhaseForEvent(startEvent, phase);\n    this.setPhaseForEvent(endEvent, phase);\n    return new Common.SegmentedRange.Segment(\n        startEvent.startTime, startEvent.endTime !== undefined ? startEvent.endTime : Number.MAX_SAFE_INTEGER, phase);\n  }\n\n  private setPhaseForEvent(asyncEvent: SDK.TracingModel.AsyncEvent, phase: Phases): void {\n    eventToPhase.set(asyncEvent.steps[0], phase);\n  }\n\n  interactionRecords(): Common.SegmentedRange.Segment<Phases>[] {\n    return this.segments;\n  }\n\n  reset(): void {\n    const thresholdsMs = TimelineIRModel._mergeThresholdsMs;\n\n    this.segments = [];\n    this.drags = new Common.SegmentedRange.SegmentedRange(merge.bind(null, thresholdsMs.mouse));\n    this.cssAnimations = new Common.SegmentedRange.SegmentedRange(merge.bind(null, thresholdsMs.animation));\n    this.responses = new Common.SegmentedRange.SegmentedRange(merge.bind(null, 0));\n    this.scrolls = new Common.SegmentedRange.SegmentedRange(merge.bind(null, thresholdsMs.animation));\n\n    function merge(\n        threshold: number, first: Common.SegmentedRange.Segment<Phases>,\n        second: Common.SegmentedRange.Segment<Phases>): Common.SegmentedRange.Segment<Phases>|null {\n      return first.end + threshold >= second.begin && first.data === second.data ? first : null;\n    }\n  }\n\n  private inputEventType(eventName: string): InputEvents|null {\n    const prefix = 'InputLatency::';\n    if (!eventName.startsWith(prefix)) {\n      const inputEventName = eventName as InputEvents;\n      if (inputEventName === InputEvents.ImplSideFling) {\n        return inputEventName;\n      }\n      console.error('Unrecognized input latency event: ' + eventName);\n      return null;\n    }\n    return eventName.substr(prefix.length) as InputEvents;\n  }\n}\n\n// TODO(crbug.com/1167717): Make this a const enum again\n// eslint-disable-next-line rulesdir/const_enum\nexport enum Phases {\n  Idle = 'Idle',\n  Response = 'Response',\n  Scroll = 'Scroll',\n  Fling = 'Fling',\n  Drag = 'Drag',\n  Animation = 'Animation',\n  Uncategorized = 'Uncategorized',\n}\n\n// TODO(crbug.com/1167717): Make this a const enum again\n// eslint-disable-next-line rulesdir/const_enum\nexport enum InputEvents {\n  Char = 'Char',\n  Click = 'GestureClick',\n  ContextMenu = 'ContextMenu',\n  FlingCancel = 'GestureFlingCancel',\n  FlingStart = 'GestureFlingStart',\n  ImplSideFling = 'InputHandlerProxy::HandleGestureFling::started',\n  KeyDown = 'KeyDown',\n  KeyDownRaw = 'RawKeyDown',\n  KeyUp = 'KeyUp',\n  LatencyScrollUpdate = 'ScrollUpdate',\n  MouseDown = 'MouseDown',\n  MouseMove = 'MouseMove',\n  MouseUp = 'MouseUp',\n  MouseWheel = 'MouseWheel',\n  PinchBegin = 'GesturePinchBegin',\n  PinchEnd = 'GesturePinchEnd',\n  PinchUpdate = 'GesturePinchUpdate',\n  ScrollBegin = 'GestureScrollBegin',\n  ScrollEnd = 'GestureScrollEnd',\n  ScrollUpdate = 'GestureScrollUpdate',\n  ScrollUpdateRenderer = 'ScrollUpdate',\n  ShowPress = 'GestureShowPress',\n  Tap = 'GestureTap',\n  TapCancel = 'GestureTapCancel',\n  TapDown = 'GestureTapDown',\n  TouchCancel = 'TouchCancel',\n  TouchEnd = 'TouchEnd',\n  TouchMove = 'TouchMove',\n  TouchStart = 'TouchStart',\n}\n\nexport namespace TimelineIRModel {\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  export const _mergeThresholdsMs = {\n    animation: 1,\n    mouse: 40,\n  };\n\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  export const _eventIRPhase = Symbol('eventIRPhase');\n}\n"]}