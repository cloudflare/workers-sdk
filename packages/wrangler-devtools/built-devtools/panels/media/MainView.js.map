{"version":3,"file":"MainView.js","sourceRoot":"","sources":["../../../../../../front_end/panels/media/MainView.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2019 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as Common from '../../core/common/common.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport type * as Protocol from '../../generated/protocol.js';\n\nimport type {PlayerEvent} from './MediaModel.js';\nimport {MediaModel, Events} from './MediaModel.js';\nimport {PlayerDetailView} from './PlayerDetailView.js';\nimport {PlayerListView} from './PlayerListView.js';\n\nexport interface TriggerHandler {\n  onProperty(property: Protocol.Media.PlayerProperty): void;\n  onError(error: Protocol.Media.PlayerError): void;\n  onMessage(message: Protocol.Media.PlayerMessage): void;\n  onEvent(event: PlayerEvent): void;\n}\n\nexport interface TriggerDispatcher {\n  onProperty(playerID: string, property: Protocol.Media.PlayerProperty): void;\n  onError(playerID: string, error: Protocol.Media.PlayerError): void;\n  onMessage(playerID: string, message: Protocol.Media.PlayerMessage): void;\n  onEvent(playerID: string, event: PlayerEvent): void;\n}\n\nclass PlayerDataCollection implements TriggerHandler {\n  private readonly properties: Map<string, string>;\n  private readonly messages: Protocol.Media.PlayerMessage[];\n  private readonly events: PlayerEvent[];\n  private readonly errors: Protocol.Media.PlayerError[];\n\n  constructor() {\n    this.properties = new Map();\n    this.messages = [];\n    this.events = [];\n    this.errors = [];\n  }\n\n  onProperty(property: Protocol.Media.PlayerProperty): void {\n    this.properties.set(property.name, property.value);\n  }\n\n  onError(error: Protocol.Media.PlayerError): void {\n    this.errors.push(error);\n  }\n\n  onMessage(message: Protocol.Media.PlayerMessage): void {\n    this.messages.push(message);\n  }\n\n  onEvent(event: PlayerEvent): void {\n    this.events.push(event);\n  }\n\n  export(): {\n    properties: Map<string, string>,\n    messages: Protocol.Media.PlayerMessage[],\n    events: PlayerEvent[],\n    errors: Protocol.Media.PlayerError[],\n  } {\n    return {'properties': this.properties, 'messages': this.messages, 'events': this.events, 'errors': this.errors};\n  }\n}\n\nclass PlayerDataDownloadManager implements TriggerDispatcher {\n  private readonly playerDataCollection: Map<string, PlayerDataCollection>;\n  constructor() {\n    this.playerDataCollection = new Map();\n  }\n\n  addPlayer(playerID: string): void {\n    this.playerDataCollection.set(playerID, new PlayerDataCollection());\n  }\n\n  onProperty(playerID: string, property: Protocol.Media.PlayerProperty): void {\n    const playerProperty = this.playerDataCollection.get(playerID);\n    if (!playerProperty) {\n      return;\n    }\n\n    playerProperty.onProperty(property);\n  }\n\n  onError(playerID: string, error: Protocol.Media.PlayerError): void {\n    const playerProperty = this.playerDataCollection.get(playerID);\n    if (!playerProperty) {\n      return;\n    }\n\n    playerProperty.onError(error);\n  }\n\n  onMessage(playerID: string, message: Protocol.Media.PlayerMessage): void {\n    const playerProperty = this.playerDataCollection.get(playerID);\n    if (!playerProperty) {\n      return;\n    }\n\n    playerProperty.onMessage(message);\n  }\n\n  onEvent(playerID: string, event: PlayerEvent): void {\n    const playerProperty = this.playerDataCollection.get(playerID);\n    if (!playerProperty) {\n      return;\n    }\n\n    playerProperty.onEvent(event);\n  }\n\n  exportPlayerData(playerID: string): {\n    properties: Map<string, string>,\n    messages: Protocol.Media.PlayerMessage[],\n    events: PlayerEvent[],\n    errors: Protocol.Media.PlayerError[],\n  } {\n    const playerProperty = this.playerDataCollection.get(playerID);\n    if (!playerProperty) {\n      throw new Error('Unable to find player');\n    }\n\n    return playerProperty.export();\n  }\n\n  deletePlayer(playerID: string): void {\n    this.playerDataCollection.delete(playerID);\n  }\n}\n\nlet mainViewInstance: MainView;\nexport class MainView extends UI.Panel.PanelWithSidebar implements SDK.TargetManager.SDKModelObserver<MediaModel> {\n  private detailPanels: Map<string, PlayerDetailView>;\n  private deletedPlayers: Set<string>;\n  private readonly downloadStore: PlayerDataDownloadManager;\n  private readonly sidebar: PlayerListView;\n\n  constructor() {\n    super('Media');\n    this.detailPanels = new Map();\n\n    this.deletedPlayers = new Set();\n\n    this.downloadStore = new PlayerDataDownloadManager();\n\n    this.sidebar = new PlayerListView(this);\n    this.sidebar.show(this.panelSidebarElement());\n\n    SDK.TargetManager.TargetManager.instance().observeModels(MediaModel, this);\n  }\n\n  static instance(opts = {forceNew: null}): MainView {\n    const {forceNew} = opts;\n    if (!mainViewInstance || forceNew) {\n      mainViewInstance = new MainView();\n    }\n\n    return mainViewInstance;\n  }\n\n  renderMainPanel(playerID: string): void {\n    if (!this.detailPanels.has(playerID)) {\n      return;\n    }\n    const mainWidget = this.splitWidget().mainWidget();\n    if (mainWidget) {\n      mainWidget.detachChildWidgets();\n    }\n    this.detailPanels.get(playerID)?.show(this.mainElement());\n  }\n\n  wasShown(): void {\n    super.wasShown();\n    for (const model of SDK.TargetManager.TargetManager.instance().models(MediaModel)) {\n      this.addEventListeners(model);\n    }\n  }\n\n  willHide(): void {\n    for (const model of SDK.TargetManager.TargetManager.instance().models(MediaModel)) {\n      this.removeEventListeners(model);\n    }\n  }\n\n  modelAdded(model: MediaModel): void {\n    if (this.isShowing()) {\n      this.addEventListeners(model);\n    }\n  }\n\n  modelRemoved(model: MediaModel): void {\n    this.removeEventListeners(model);\n  }\n\n  private addEventListeners(mediaModel: MediaModel): void {\n    mediaModel.ensureEnabled();\n    mediaModel.addEventListener(Events.PlayerPropertiesChanged, this.propertiesChanged, this);\n    mediaModel.addEventListener(Events.PlayerEventsAdded, this.eventsAdded, this);\n    mediaModel.addEventListener(Events.PlayerMessagesLogged, this.messagesLogged, this);\n    mediaModel.addEventListener(Events.PlayerErrorsRaised, this.errorsRaised, this);\n    mediaModel.addEventListener(Events.PlayersCreated, this.playersCreated, this);\n  }\n\n  private removeEventListeners(mediaModel: MediaModel): void {\n    mediaModel.removeEventListener(Events.PlayerPropertiesChanged, this.propertiesChanged, this);\n    mediaModel.removeEventListener(Events.PlayerEventsAdded, this.eventsAdded, this);\n    mediaModel.removeEventListener(Events.PlayerMessagesLogged, this.messagesLogged, this);\n    mediaModel.removeEventListener(Events.PlayerErrorsRaised, this.errorsRaised, this);\n    mediaModel.removeEventListener(Events.PlayersCreated, this.playersCreated, this);\n  }\n\n  private onPlayerCreated(playerID: string): void {\n    this.sidebar.addMediaElementItem(playerID);\n    this.detailPanels.set(playerID, new PlayerDetailView());\n    this.downloadStore.addPlayer(playerID);\n  }\n\n  private propertiesChanged(event: Common.EventTarget.EventTargetEvent<Protocol.Media.PlayerPropertiesChangedEvent>):\n      void {\n    for (const property of event.data.properties) {\n      this.onProperty(event.data.playerId, property);\n    }\n  }\n\n  private eventsAdded(event: Common.EventTarget.EventTargetEvent<Protocol.Media.PlayerEventsAddedEvent>): void {\n    for (const ev of event.data.events) {\n      // TODO(crbug.com/1228674): The conversion from Protocol.Media.PlayerEvent to PlayerEvent happens implicitly\n      // by augmenting the protocol type with some additional property in various places. This needs to be cleaned up\n      // in a conversion function that takes the protocol type and produces the PlayerEvent type.\n      this.onEvent(event.data.playerId, ev as PlayerEvent);\n    }\n  }\n\n  private messagesLogged(event: Common.EventTarget.EventTargetEvent<Protocol.Media.PlayerMessagesLoggedEvent>): void {\n    for (const message of event.data.messages) {\n      this.onMessage(event.data.playerId, message);\n    }\n  }\n\n  private errorsRaised(event: Common.EventTarget.EventTargetEvent<Protocol.Media.PlayerErrorsRaisedEvent>): void {\n    for (const error of event.data.errors) {\n      this.onError(event.data.playerId, error);\n    }\n  }\n\n  private shouldPropagate(playerID: string): boolean {\n    return !this.deletedPlayers.has(playerID) && this.detailPanels.has(playerID);\n  }\n\n  onProperty(playerID: string, property: Protocol.Media.PlayerProperty): void {\n    if (!this.shouldPropagate(playerID)) {\n      return;\n    }\n    this.sidebar.onProperty(playerID, property);\n    this.downloadStore.onProperty(playerID, property);\n    this.detailPanels.get(playerID)?.onProperty(property);\n  }\n\n  onError(playerID: string, error: Protocol.Media.PlayerError): void {\n    if (!this.shouldPropagate(playerID)) {\n      return;\n    }\n    this.sidebar.onError(playerID, error);\n    this.downloadStore.onError(playerID, error);\n    this.detailPanels.get(playerID)?.onError(error);\n  }\n\n  onMessage(playerID: string, message: Protocol.Media.PlayerMessage): void {\n    if (!this.shouldPropagate(playerID)) {\n      return;\n    }\n    this.sidebar.onMessage(playerID, message);\n    this.downloadStore.onMessage(playerID, message);\n    this.detailPanels.get(playerID)?.onMessage(message);\n  }\n\n  onEvent(playerID: string, event: PlayerEvent): void {\n    if (!this.shouldPropagate(playerID)) {\n      return;\n    }\n    this.sidebar.onEvent(playerID, event);\n    this.downloadStore.onEvent(playerID, event);\n    this.detailPanels.get(playerID)?.onEvent(event);\n  }\n\n  private playersCreated(event: Common.EventTarget.EventTargetEvent<Protocol.Media.PlayerId[]>): void {\n    for (const playerID of event.data) {\n      this.onPlayerCreated(playerID);\n    }\n  }\n\n  markPlayerForDeletion(playerID: string): void {\n    // TODO(tmathmeyer): send this to chromium to save the storage space there too.\n    this.deletedPlayers.add(playerID);\n    this.detailPanels.delete(playerID);\n    this.sidebar.deletePlayer(playerID);\n    this.downloadStore.deletePlayer(playerID);\n  }\n\n  markOtherPlayersForDeletion(playerID: string): void {\n    for (const keyID of this.detailPanels.keys()) {\n      if (keyID !== playerID) {\n        this.markPlayerForDeletion(keyID);\n      }\n    }\n  }\n\n  exportPlayerData(playerID: string): void {\n    const dump = this.downloadStore.exportPlayerData(playerID);\n    const uriContent = 'data:application/octet-stream,' + encodeURIComponent(JSON.stringify(dump, null, 2));\n    const anchor = document.createElement('a');\n    anchor.href = uriContent;\n    anchor.download = playerID + '.json';\n    anchor.click();\n  }\n}\n"]}