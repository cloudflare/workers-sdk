{"version":3,"file":"LighthouseReportSelector.js","sourceRoot":"","sources":["../../../../../../front_end/panels/lighthouse/LighthouseReportSelector.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2018 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport type * as ReportRenderer from './LighthouseReporterTypes.js';\n\nconst UIStrings = {\n  /**\n  *@description Title of combo box in audits report selector\n  */\n  reports: 'Reports',\n  /**\n  *@description New report item label in Lighthouse Report Selector\n  */\n  newReport: '(new report)',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/lighthouse/LighthouseReportSelector.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nexport class ReportSelector {\n  private readonly renderNewLighthouseView: () => void;\n  private newLighthouseItem: HTMLOptionElement;\n  private readonly comboBoxInternal: UI.Toolbar.ToolbarComboBox;\n  private readonly itemByOptionElement: Map<Element, Item>;\n\n  constructor(renderNewLighthouseView: () => void) {\n    this.renderNewLighthouseView = renderNewLighthouseView;\n    this.newLighthouseItem = document.createElement('option');\n    this.comboBoxInternal = new UI.Toolbar.ToolbarComboBox(\n        this.handleChange.bind(this), i18nString(UIStrings.reports), 'lighthouse-report');\n    this.comboBoxInternal.setMaxWidth(180);\n    this.comboBoxInternal.setMinWidth(140);\n    this.itemByOptionElement = new Map();\n    this.setEmptyState();\n  }\n\n  private setEmptyState(): void {\n    this.comboBoxInternal.selectElement().removeChildren();\n\n    this.comboBoxInternal.setEnabled(false);\n    this.newLighthouseItem = document.createElement('option');\n    this.newLighthouseItem.label = i18nString(UIStrings.newReport);\n    this.comboBoxInternal.selectElement().appendChild(this.newLighthouseItem);\n    this.comboBoxInternal.select(this.newLighthouseItem);\n  }\n\n  private handleChange(_event: Event): void {\n    const item = this.selectedItem();\n    if (item) {\n      item.select();\n    } else {\n      this.renderNewLighthouseView();\n    }\n  }\n\n  private selectedItem(): Item {\n    const option = this.comboBoxInternal.selectedOption();\n    return this.itemByOptionElement.get(option as Element) as Item;\n  }\n\n  hasCurrentSelection(): boolean {\n    return Boolean(this.selectedItem());\n  }\n\n  hasItems(): boolean {\n    return this.itemByOptionElement.size > 0;\n  }\n\n  comboBox(): UI.Toolbar.ToolbarComboBox {\n    return this.comboBoxInternal;\n  }\n\n  prepend(item: Item): void {\n    const optionEl = item.optionElement();\n    const selectEl = this.comboBoxInternal.selectElement();\n\n    this.itemByOptionElement.set(optionEl, item);\n    selectEl.insertBefore(optionEl, selectEl.firstElementChild);\n    this.comboBoxInternal.setEnabled(true);\n    this.comboBoxInternal.select(optionEl);\n    item.select();\n  }\n\n  clearAll(): void {\n    for (const elem of this.comboBoxInternal.options()) {\n      if (elem === this.newLighthouseItem) {\n        continue;\n      }\n\n      this.itemByOptionElement.get(elem)?.delete();\n      this.itemByOptionElement.delete(elem);\n    }\n\n    this.setEmptyState();\n  }\n\n  selectNewReport(): void {\n    this.comboBoxInternal.select(this.newLighthouseItem);\n  }\n}\n\nexport class Item {\n  private readonly lighthouseResult: ReportRenderer.ReportJSON;\n  private readonly renderReport: () => void;\n  private readonly showLandingCallback: () => void;\n  private readonly element: HTMLOptionElement;\n\n  constructor(lighthouseResult: ReportRenderer.ReportJSON, renderReport: () => void, showLandingCallback: () => void) {\n    this.lighthouseResult = lighthouseResult;\n    this.renderReport = renderReport;\n    this.showLandingCallback = showLandingCallback;\n\n    const url = new Common.ParsedURL.ParsedURL(lighthouseResult.finalUrl);\n    const timestamp = lighthouseResult.fetchTime;\n    this.element = document.createElement('option');\n    this.element.label = `${new Date(timestamp).toLocaleTimeString()} - ${url.domain()}`;\n  }\n\n  select(): void {\n    this.renderReport();\n  }\n\n  optionElement(): Element {\n    return this.element;\n  }\n\n  delete(): void {\n    if (this.element) {\n      this.element.remove();\n    }\n    this.showLandingCallback();\n  }\n}\n"]}