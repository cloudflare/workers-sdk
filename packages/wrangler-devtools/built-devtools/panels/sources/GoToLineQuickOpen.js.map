{"version":3,"file":"GoToLineQuickOpen.js","sourceRoot":"","sources":["../../../../../../front_end/panels/sources/GoToLineQuickOpen.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2016 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as Workspace from '../../models/workspace/workspace.js';\nimport * as QuickOpen from '../../ui/legacy/components/quick_open/quick_open.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport {SourcesView} from './SourcesView.js';\nimport type {UISourceCodeFrame} from './UISourceCodeFrame.js';\n\nconst UIStrings = {\n  /**\n  *@description Text in Go To Line Quick Open of the Sources panel\n  */\n  noFileSelected: 'No file selected.',\n  /**\n  *@description Text to show no results have been found\n  */\n  noResultsFound: 'No results found',\n  /**\n  *@description Text in Go To Line Quick Open of the Sources panel\n  */\n  typeANumberToGoToThatLine: 'Type a number to go to that line.',\n  /**\n  *@description Text in Go To Line Quick Open of the Sources panel\n  *@example {abc} PH1\n  *@example {000} PH2\n  *@example {bbb} PH3\n  */\n  currentPositionXsTypeAnOffset:\n      'Current position: 0x{PH1}. Type an offset between 0x{PH2} and 0x{PH3} to navigate to.',\n  /**\n  *@description Text in the GoToLine dialog of the Sources pane that describes the current line number, file line number range, and use of the GoToLine dialog\n  *@example {1} PH1\n  *@example {100} PH2\n  */\n  currentLineSTypeALineNumber: 'Current line: {PH1}. Type a line number between 1 and {PH2} to navigate to.',\n  /**\n  *@description Text in Go To Line Quick Open of the Sources panel\n  *@example {abc} PH1\n  */\n  goToOffsetXs: 'Go to offset 0x{PH1}.',\n  /**\n  *@description Text in Go To Line Quick Open of the Sources panel\n  *@example {2} PH1\n  *@example {2} PH2\n  */\n  goToLineSAndColumnS: 'Go to line {PH1} and column {PH2}.',\n  /**\n  *@description Text in Go To Line Quick Open of the Sources panel\n  *@example {2} PH1\n  */\n  goToLineS: 'Go to line {PH1}.',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/sources/GoToLineQuickOpen.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nlet goToLineQuickOpenInstance: GoToLineQuickOpen;\nexport class GoToLineQuickOpen extends QuickOpen.FilteredListWidget.Provider {\n  #goToLineStrings: string[] = [];\n\n  static instance(opts: {\n    forceNew: boolean|null,\n  } = {forceNew: null}): GoToLineQuickOpen {\n    const {forceNew} = opts;\n    if (!goToLineQuickOpenInstance || forceNew) {\n      goToLineQuickOpenInstance = new GoToLineQuickOpen();\n    }\n\n    return goToLineQuickOpenInstance;\n  }\n\n  selectItem(_itemIndex: number|null, promptValue: string): void {\n    const uiSourceCode = this.currentUISourceCode();\n    if (!uiSourceCode) {\n      return;\n    }\n    const position = this.parsePosition(promptValue);\n    if (!position) {\n      return;\n    }\n    void Common.Revealer.reveal(uiSourceCode.uiLocation(position.line - 1, position.column - 1));\n  }\n\n  updateGoToLineStrings(query: string): void {\n    this.#goToLineStrings = [];\n    if (!this.currentUISourceCode()) {\n      return;\n    }\n    const position = this.parsePosition(query);\n    const sourceFrame = this.currentSourceFrame();\n    if (!position) {\n      if (!sourceFrame) {\n        this.#goToLineStrings.push(i18nString(UIStrings.typeANumberToGoToThatLine));\n        return;\n      }\n      const editorState = sourceFrame.textEditor.state;\n      const disassembly = sourceFrame.wasmDisassembly;\n      const currentLineNumber = editorState.doc.lineAt(editorState.selection.main.head).number - 1;\n      if (disassembly) {\n        const lastBytecodeOffset = disassembly.lineNumberToBytecodeOffset(disassembly.lineNumbers - 1);\n        const bytecodeOffsetDigits = lastBytecodeOffset.toString(16).length;\n        const currentPosition = disassembly.lineNumberToBytecodeOffset(currentLineNumber);\n        this.#goToLineStrings.push(i18nString(UIStrings.currentPositionXsTypeAnOffset, {\n          PH1: currentPosition.toString(16).padStart(bytecodeOffsetDigits, '0'),\n          PH2: '0'.padStart(bytecodeOffsetDigits, '0'),\n          PH3: lastBytecodeOffset.toString(16),\n        }));\n        return;\n      }\n      const linesCount = editorState.doc.lines;\n      this.#goToLineStrings.push(\n          i18nString(UIStrings.currentLineSTypeALineNumber, {PH1: currentLineNumber + 1, PH2: linesCount}));\n      return;\n    }\n\n    if (sourceFrame && sourceFrame.wasmDisassembly) {\n      this.#goToLineStrings.push(i18nString(UIStrings.goToOffsetXs, {PH1: (position.column - 1).toString(16)}));\n      return;\n    }\n    if (position.column && position.column > 1) {\n      this.#goToLineStrings.push(i18nString(UIStrings.goToLineSAndColumnS, {PH1: position.line, PH2: position.column}));\n      return;\n    }\n    if (sourceFrame && position.line > sourceFrame.textEditor.state.doc.lines) {\n      return;\n    }\n    this.#goToLineStrings.push(i18nString(UIStrings.goToLineS, {PH1: position.line}));\n  }\n\n  itemCount(): number {\n    return this.#goToLineStrings.length;\n  }\n\n  renderItem(itemIndex: number, _query: string, titleElement: Element, _subtitleElement: Element): void {\n    UI.UIUtils.createTextChild(titleElement, this.#goToLineStrings[itemIndex]);\n  }\n\n  rewriteQuery(_query: string): string {\n    // For Go to Line Quick Open, we don't need to filter any item, set query to empty string, so the filter regex matching will be skipped\n    return '';\n  }\n\n  queryChanged(query: string): void {\n    this.updateGoToLineStrings(query);\n  }\n\n  notFoundText(_query: string): string {\n    if (!this.currentUISourceCode()) {\n      return i18nString(UIStrings.noFileSelected);\n    }\n    return i18nString(UIStrings.noResultsFound);\n  }\n\n  private parsePosition(query: string): {\n    line: number,\n    column: number,\n  }|null {\n    const sourceFrame = this.currentSourceFrame();\n    if (sourceFrame && sourceFrame.wasmDisassembly) {\n      const parts = query.match(/0x([0-9a-fA-F]+)/);\n      if (!parts || !parts[0] || parts[0].length !== query.length) {\n        return null;\n      }\n\n      const column = parseInt(parts[0], 16) + 1;\n      return {line: 0, column};\n    }\n\n    const parts = query.match(/([0-9]+)(\\:[0-9]*)?/);\n    if (!parts || !parts[0] || parts[0].length !== query.length) {\n      return null;\n    }\n    const line = parseInt(parts[1], 10);\n    let column = 0;\n    if (parts[2]) {\n      column = parseInt(parts[2].substring(1), 10);\n    }\n    return {line: Math.max(line | 0, 1), column: Math.max(column | 0, 1)};\n  }\n\n  private currentUISourceCode(): Workspace.UISourceCode.UISourceCode|null {\n    const sourcesView = UI.Context.Context.instance().flavor(SourcesView);\n    if (!sourcesView) {\n      return null;\n    }\n    return sourcesView.currentUISourceCode();\n  }\n\n  private currentSourceFrame(): UISourceCodeFrame|null {\n    const sourcesView = UI.Context.Context.instance().flavor(SourcesView);\n    if (!sourcesView) {\n      return null;\n    }\n    return sourcesView.currentSourceFrame();\n  }\n}\n"]}