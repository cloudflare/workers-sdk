{"version":3,"file":"UISourceCodeFrame.js","sourceRoot":"","sources":["../../../../../../front_end/panels/sources/UISourceCodeFrame.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright (C) 2012 Google Inc. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are\n * met:\n *\n *     * Redistributions of source code must retain the above copyright\n * notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above\n * copyright notice, this list of conditions and the following disclaimer\n * in the documentation and/or other materials provided with the\n * distribution.\n *     * Neither the name of Google Inc. nor the names of its\n * contributors may be used to endorse or promote products derived from\n * this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport * as Common from '../../core/common/common.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport * as Root from '../../core/root/root.js';\nimport * as IssuesManager from '../../models/issues_manager/issues_manager.js';\nimport * as Persistence from '../../models/persistence/persistence.js';\nimport type * as TextUtils from '../../models/text_utils/text_utils.js';\nimport * as Workspace from '../../models/workspace/workspace.js';\nimport * as CodeMirror from '../../third_party/codemirror.next/codemirror.next.js';\nimport * as IconButton from '../../ui/components/icon_button/icon_button.js';\nimport * as IssueCounter from '../../ui/components/issue_counter/issue_counter.js';\nimport * as SourceFrame from '../../ui/legacy/components/source_frame/source_frame.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport {CoveragePlugin} from './CoveragePlugin.js';\nimport {CSSPlugin} from './CSSPlugin.js';\nimport {DebuggerPlugin} from './DebuggerPlugin.js';\nimport {MemoryProfilePlugin, PerformanceProfilePlugin} from './ProfilePlugin.js';\nimport {JavaScriptCompilerPlugin} from './JavaScriptCompilerPlugin.js';\nimport type {Plugin} from './Plugin.js';\nimport {ScriptOriginPlugin} from './ScriptOriginPlugin.js';\nimport {SnippetsPlugin} from './SnippetsPlugin.js';\nimport {SourcesPanel} from './SourcesPanel.js';\n\nfunction sourceFramePlugins(): (typeof Plugin)[] {\n  // The order of these plugins matters for toolbar items and editor\n  // extension precedence\n  return [\n    CSSPlugin,\n    DebuggerPlugin,\n    JavaScriptCompilerPlugin,\n    SnippetsPlugin,\n    ScriptOriginPlugin,\n    CoveragePlugin,\n    MemoryProfilePlugin,\n    PerformanceProfilePlugin,\n  ];\n}\n\nexport class UISourceCodeFrame extends\n    Common.ObjectWrapper.eventMixin<EventTypes, typeof SourceFrame.SourceFrame.SourceFrameImpl>(\n        SourceFrame.SourceFrame.SourceFrameImpl) {\n  private uiSourceCodeInternal: Workspace.UISourceCode.UISourceCode;\n  private muteSourceCodeEvents: boolean;\n  private persistenceBinding: Persistence.Persistence.PersistenceBinding|null;\n  private uiSourceCodeEventListeners: Common.EventTarget.EventDescriptor[];\n  private messageAndDecorationListeners: Common.EventTarget.EventDescriptor[];\n  private readonly boundOnBindingChanged: () => void;\n  // The active plugins. These are created in setContent, and\n  // recreated when the binding changes\n  private plugins: Plugin[] = [];\n  private readonly errorPopoverHelper: UI.PopoverHelper.PopoverHelper;\n\n  constructor(uiSourceCode: Workspace.UISourceCode.UISourceCode) {\n    super(workingCopy);\n    this.uiSourceCodeInternal = uiSourceCode;\n\n    this.muteSourceCodeEvents = false;\n\n    this.persistenceBinding = Persistence.Persistence.PersistenceImpl.instance().binding(uiSourceCode);\n\n    this.uiSourceCodeEventListeners = [];\n    this.messageAndDecorationListeners = [];\n\n    this.boundOnBindingChanged = this.onBindingChanged.bind(this);\n\n    Common.Settings.Settings.instance()\n        .moduleSetting('persistenceNetworkOverridesEnabled')\n        .addChangeListener(this.onNetworkPersistenceChanged, this);\n\n    this.errorPopoverHelper =\n        new UI.PopoverHelper.PopoverHelper(this.textEditor.editor.contentDOM, this.getErrorPopoverContent.bind(this));\n    this.errorPopoverHelper.setHasPadding(true);\n\n    this.errorPopoverHelper.setTimeout(100, 100);\n\n    this.initializeUISourceCode();\n\n    async function workingCopy(): Promise<TextUtils.ContentProvider.DeferredContent> {\n      if (uiSourceCode.isDirty()) {\n        return {content: uiSourceCode.workingCopy(), isEncoded: false};\n      }\n      return uiSourceCode.requestContent();\n    }\n  }\n\n  protected editorConfiguration(doc: string): CodeMirror.Extension {\n    return [\n      super.editorConfiguration(doc),\n      rowMessages([...this.allMessages()]),\n      // Inject editor extensions from plugins\n      pluginCompartment.of(this.plugins.map(plugin => plugin.editorExtension())),\n    ];\n  }\n\n  protected onFocus(): void {\n    super.onFocus();\n    UI.Context.Context.instance().setFlavor(UISourceCodeFrame, this);\n  }\n\n  protected onBlur(): void {\n    super.onBlur();\n    UI.Context.Context.instance().setFlavor(UISourceCodeFrame, null);\n  }\n\n  private installMessageAndDecorationListeners(): void {\n    if (this.persistenceBinding) {\n      const networkSourceCode = this.persistenceBinding.network;\n      const fileSystemSourceCode = this.persistenceBinding.fileSystem;\n      this.messageAndDecorationListeners = [\n        networkSourceCode.addEventListener(Workspace.UISourceCode.Events.MessageAdded, this.onMessageAdded, this),\n        networkSourceCode.addEventListener(Workspace.UISourceCode.Events.MessageRemoved, this.onMessageRemoved, this),\n        networkSourceCode.addEventListener(\n            Workspace.UISourceCode.Events.DecorationChanged, this.onDecorationChanged, this),\n\n        fileSystemSourceCode.addEventListener(Workspace.UISourceCode.Events.MessageAdded, this.onMessageAdded, this),\n        fileSystemSourceCode.addEventListener(\n            Workspace.UISourceCode.Events.MessageRemoved, this.onMessageRemoved, this),\n      ];\n    } else {\n      this.messageAndDecorationListeners = [\n        this.uiSourceCodeInternal.addEventListener(\n            Workspace.UISourceCode.Events.MessageAdded, this.onMessageAdded, this),\n        this.uiSourceCodeInternal.addEventListener(\n            Workspace.UISourceCode.Events.MessageRemoved, this.onMessageRemoved, this),\n        this.uiSourceCodeInternal.addEventListener(\n            Workspace.UISourceCode.Events.DecorationChanged, this.onDecorationChanged, this),\n      ];\n    }\n  }\n\n  uiSourceCode(): Workspace.UISourceCode.UISourceCode {\n    return this.uiSourceCodeInternal;\n  }\n\n  setUISourceCode(uiSourceCode: Workspace.UISourceCode.UISourceCode): void {\n    const loaded = uiSourceCode.contentLoaded() ? Promise.resolve() : uiSourceCode.requestContent();\n    const startUISourceCode = this.uiSourceCodeInternal;\n    loaded.then(() => {\n      if (this.uiSourceCodeInternal !== startUISourceCode) {\n        return;\n      }\n      this.unloadUISourceCode();\n      this.uiSourceCodeInternal = uiSourceCode;\n      if (uiSourceCode.workingCopy() !== this.textEditor.state.doc.toString()) {\n        void this.setContent(uiSourceCode.workingCopy());\n      } else {\n        this.reloadPlugins();\n      }\n      this.initializeUISourceCode();\n    }, console.error);\n  }\n\n  private unloadUISourceCode(): void {\n    Common.EventTarget.removeEventListeners(this.messageAndDecorationListeners);\n    Common.EventTarget.removeEventListeners(this.uiSourceCodeEventListeners);\n    this.uiSourceCodeInternal.removeWorkingCopyGetter();\n    Persistence.Persistence.PersistenceImpl.instance().unsubscribeFromBindingEvent(\n        this.uiSourceCodeInternal, this.boundOnBindingChanged);\n  }\n\n  private initializeUISourceCode(): void {\n    this.uiSourceCodeEventListeners = [\n      this.uiSourceCodeInternal.addEventListener(\n          Workspace.UISourceCode.Events.WorkingCopyChanged, this.onWorkingCopyChanged, this),\n      this.uiSourceCodeInternal.addEventListener(\n          Workspace.UISourceCode.Events.WorkingCopyCommitted, this.onWorkingCopyCommitted, this),\n      this.uiSourceCodeInternal.addEventListener(Workspace.UISourceCode.Events.TitleChanged, this.onTitleChanged, this),\n    ];\n\n    Persistence.Persistence.PersistenceImpl.instance().subscribeForBindingEvent(\n        this.uiSourceCodeInternal, this.boundOnBindingChanged);\n    this.installMessageAndDecorationListeners();\n    this.updateStyle();\n    if (Root.Runtime.experiments.isEnabled('sourcesPrettyPrint')) {\n      const supportedPrettyTypes = new Set<string>(['text/html', 'text/css', 'text/javascript']);\n      this.setCanPrettyPrint(supportedPrettyTypes.has(this.contentType), true);\n    }\n  }\n\n  wasShown(): void {\n    super.wasShown();\n    this.setEditable(this.canEditSourceInternal());\n  }\n\n  willHide(): void {\n    for (const plugin of this.plugins) {\n      plugin.willHide();\n    }\n    super.willHide();\n    UI.Context.Context.instance().setFlavor(UISourceCodeFrame, null);\n    this.uiSourceCodeInternal.removeWorkingCopyGetter();\n  }\n\n  protected getContentType(): string {\n    const binding = Persistence.Persistence.PersistenceImpl.instance().binding(this.uiSourceCodeInternal);\n    return binding ? binding.network.mimeType() : this.uiSourceCodeInternal.mimeType();\n  }\n\n  canEditSourceInternal(): boolean {\n    if (this.hasLoadError()) {\n      return false;\n    }\n    if (this.uiSourceCodeInternal.editDisabled()) {\n      return false;\n    }\n    if (this.uiSourceCodeInternal.mimeType() === 'application/wasm') {\n      return false;\n    }\n    if (Persistence.Persistence.PersistenceImpl.instance().binding(this.uiSourceCodeInternal)) {\n      return true;\n    }\n    if (this.uiSourceCodeInternal.project().canSetFileContent()) {\n      return true;\n    }\n    if (this.uiSourceCodeInternal.project().isServiceProject()) {\n      return false;\n    }\n    if (this.uiSourceCodeInternal.project().type() === Workspace.Workspace.projectTypes.Network &&\n        Persistence.NetworkPersistenceManager.NetworkPersistenceManager.instance().active()) {\n      return true;\n    }\n    // Because live edit fails on large whitespace changes, pretty printed scripts are not editable.\n    if (this.pretty && this.uiSourceCodeInternal.contentType().hasScripts()) {\n      return false;\n    }\n    return this.uiSourceCodeInternal.contentType() !== Common.ResourceType.resourceTypes.Document;\n  }\n\n  private onNetworkPersistenceChanged(): void {\n    this.setEditable(this.canEditSourceInternal());\n  }\n\n  commitEditing(): void {\n    if (!this.uiSourceCodeInternal.isDirty()) {\n      return;\n    }\n\n    this.muteSourceCodeEvents = true;\n    this.uiSourceCodeInternal.commitWorkingCopy();\n    this.muteSourceCodeEvents = false;\n  }\n\n  async setContent(content: string): Promise<void> {\n    this.disposePlugins();\n    this.loadPlugins();\n    await super.setContent(content);\n    for (const plugin of this.plugins) {\n      plugin.editorInitialized(this.textEditor);\n    }\n    Common.EventTarget.fireEvent('source-file-loaded', this.uiSourceCodeInternal.displayName(true));\n  }\n\n  private allMessages(): Set<Workspace.UISourceCode.Message> {\n    if (this.persistenceBinding) {\n      const combinedSet = this.persistenceBinding.network.messages();\n      Platform.SetUtilities.addAll(combinedSet, this.persistenceBinding.fileSystem.messages());\n      return combinedSet;\n    }\n    return this.uiSourceCodeInternal.messages();\n  }\n\n  onTextChanged(): void {\n    const wasPretty = this.pretty;\n    super.onTextChanged();\n    this.errorPopoverHelper.hidePopover();\n    SourcesPanel.instance().updateLastModificationTime();\n    this.muteSourceCodeEvents = true;\n    if (this.isClean()) {\n      this.uiSourceCodeInternal.resetWorkingCopy();\n    } else {\n      this.uiSourceCodeInternal.setWorkingCopyGetter(() => this.textEditor.state.doc.toString());\n    }\n    this.muteSourceCodeEvents = false;\n    if (wasPretty !== this.pretty) {\n      this.updateStyle();\n      this.reloadPlugins();\n    }\n  }\n\n  onWorkingCopyChanged(): void {\n    if (this.muteSourceCodeEvents) {\n      return;\n    }\n    this.maybeSetContent(this.uiSourceCodeInternal.workingCopy());\n  }\n\n  private onWorkingCopyCommitted(): void {\n    if (!this.muteSourceCodeEvents) {\n      this.maybeSetContent(this.uiSourceCode().workingCopy());\n    }\n    this.contentCommitted();\n    this.updateStyle();\n  }\n\n  private reloadPlugins(): void {\n    this.disposePlugins();\n    this.loadPlugins();\n    const editor = this.textEditor;\n    editor.dispatch({effects: pluginCompartment.reconfigure(this.plugins.map(plugin => plugin.editorExtension()))});\n    for (const plugin of this.plugins) {\n      plugin.editorInitialized(editor);\n    }\n  }\n\n  private onTitleChanged(): void {\n    this.updateLanguageMode('').then(() => this.reloadPlugins(), console.error);\n  }\n\n  private loadPlugins(): void {\n    const binding = Persistence.Persistence.PersistenceImpl.instance().binding(this.uiSourceCodeInternal);\n    const pluginUISourceCode = binding ? binding.network : this.uiSourceCodeInternal;\n\n    for (const pluginType of sourceFramePlugins()) {\n      if (pluginType.accepts(pluginUISourceCode)) {\n        this.plugins.push(new pluginType(pluginUISourceCode, this));\n      }\n    }\n\n    this.dispatchEventToListeners(Events.ToolbarItemsChanged);\n  }\n\n  private disposePlugins(): void {\n    for (const plugin of this.plugins) {\n      plugin.dispose();\n    }\n    this.plugins = [];\n  }\n\n  private onBindingChanged(): void {\n    const binding = Persistence.Persistence.PersistenceImpl.instance().binding(this.uiSourceCodeInternal);\n    if (binding === this.persistenceBinding) {\n      return;\n    }\n    this.unloadUISourceCode();\n    this.persistenceBinding = binding;\n    this.initializeUISourceCode();\n    this.reloadMessages();\n    this.reloadPlugins();\n  }\n\n  private reloadMessages(): void {\n    const messages = [...this.allMessages()];\n    const {editor} = this.textEditor;\n    editor.dispatch({effects: setRowMessages.of(RowMessages.create(messages))});\n  }\n\n  private updateStyle(): void {\n    this.setEditable(this.canEditSourceInternal());\n  }\n\n  private maybeSetContent(content: string): void {\n    if (this.textEditor.state.doc.toString() !== content) {\n      void this.setContent(content);\n    }\n  }\n\n  protected populateTextAreaContextMenu(\n      contextMenu: UI.ContextMenu.ContextMenu, lineNumber: number, columnNumber: number): void {\n    super.populateTextAreaContextMenu(contextMenu, lineNumber, columnNumber);\n    contextMenu.appendApplicableItems(this.uiSourceCodeInternal);\n    const location = this.editorLocationToUILocation(lineNumber, columnNumber);\n    contextMenu.appendApplicableItems(\n        new Workspace.UISourceCode.UILocation(this.uiSourceCodeInternal, location.lineNumber, location.columnNumber));\n    for (const plugin of this.plugins) {\n      plugin.populateTextAreaContextMenu(contextMenu, lineNumber, columnNumber);\n    }\n  }\n\n  protected populateLineGutterContextMenu(contextMenu: UI.ContextMenu.ContextMenu, lineNumber: number): void {\n    super.populateLineGutterContextMenu(contextMenu, lineNumber);\n    for (const plugin of this.plugins) {\n      plugin.populateLineGutterContextMenu(contextMenu, lineNumber);\n    }\n  }\n\n  dispose(): void {\n    this.errorPopoverHelper.dispose();\n    this.disposePlugins();\n    this.unloadUISourceCode();\n    this.textEditor.editor.destroy();\n    this.detach();\n    Common.Settings.Settings.instance()\n        .moduleSetting('persistenceNetworkOverridesEnabled')\n        .removeChangeListener(this.onNetworkPersistenceChanged, this);\n  }\n\n  private onMessageAdded(event: Common.EventTarget.EventTargetEvent<Workspace.UISourceCode.Message>): void {\n    const {editor} = this.textEditor, shownMessages = editor.state.field(showRowMessages, false);\n    if (shownMessages) {\n      editor.dispatch({effects: setRowMessages.of(shownMessages.messages.add(event.data))});\n    }\n  }\n\n  private onMessageRemoved(event: Common.EventTarget.EventTargetEvent<Workspace.UISourceCode.Message>): void {\n    const {editor} = this.textEditor, shownMessages = editor.state.field(showRowMessages, false);\n    if (shownMessages) {\n      editor.dispatch({effects: setRowMessages.of(shownMessages.messages.remove(event.data))});\n    }\n  }\n\n  private onDecorationChanged(event: Common.EventTarget.EventTargetEvent<string>): void {\n    for (const plugin of this.plugins) {\n      plugin.decorationChanged(event.data as SourceFrame.SourceFrame.DecoratorType, this.textEditor);\n    }\n  }\n\n  async toolbarItems(): Promise<UI.Toolbar.ToolbarItem[]> {\n    const leftToolbarItems = await super.toolbarItems();\n    const rightToolbarItems = [];\n    for (const plugin of this.plugins) {\n      leftToolbarItems.push(...plugin.leftToolbarItems());\n      rightToolbarItems.push(...await plugin.rightToolbarItems());\n    }\n\n    if (!rightToolbarItems.length) {\n      return leftToolbarItems;\n    }\n\n    return [...leftToolbarItems, new UI.Toolbar.ToolbarSeparator(true), ...rightToolbarItems];\n  }\n\n  private getErrorPopoverContent(event: Event): UI.PopoverHelper.PopoverRequest|null {\n    const mouseEvent = event as MouseEvent;\n    const eventTarget = event.target as HTMLElement;\n    const anchorElement = eventTarget.enclosingNodeOrSelfWithClass('cm-messageIcon-error') ||\n        eventTarget.enclosingNodeOrSelfWithClass('cm-messageIcon-issue');\n    if (!anchorElement) {\n      return null;\n    }\n\n    const messageField = this.textEditor.state.field(showRowMessages, false);\n    if (!messageField || messageField.messages.rows.length === 0) {\n      return null;\n    }\n    const {editor} = this.textEditor;\n    const position = editor.posAtCoords(mouseEvent);\n    if (position === null) {\n      return null;\n    }\n    const line = editor.state.doc.lineAt(position);\n    if (position !== line.to) {\n      return null;\n    }\n    const row = messageField.messages.rows.find(row => row[0].lineNumber() === line.number - 1);\n    if (!row) {\n      return null;\n    }\n    const issues = anchorElement.classList.contains('cm-messageIcon-issue');\n    const messages = row.filter(msg => (msg.level() === Workspace.UISourceCode.Message.Level.Issue) === issues);\n    if (!messages.length) {\n      return null;\n    }\n    const anchor =\n        anchorElement ? anchorElement.boxInWindow() : new AnchorBox(mouseEvent.clientX, mouseEvent.clientY, 1, 1);\n\n    const counts = countDuplicates(messages);\n    const element = document.createElement('div');\n    element.classList.add('text-editor-messages-description-container');\n    for (let i = 0; i < messages.length; i++) {\n      if (counts[i]) {\n        element.appendChild(renderMessage(messages[i], counts[i]));\n      }\n    }\n    return {\n      box: anchor,\n      hide(): void{},\n      show: async(popover: UI.GlassPane.GlassPane): Promise<true> => {\n        popover.contentElement.append(element);\n        return true;\n      },\n    };\n  }\n}\n\nfunction getIconDataForLevel(level: Workspace.UISourceCode.Message.Level): IconButton.Icon.IconData {\n  if (level === Workspace.UISourceCode.Message.Level.Error) {\n    return {color: '', width: '12px', height: '12px', iconName: 'error_icon'};\n  }\n  if (level === Workspace.UISourceCode.Message.Level.Warning) {\n    return {color: '', width: '12px', height: '12px', iconName: 'warning_icon'};\n  }\n  if (level === Workspace.UISourceCode.Message.Level.Issue) {\n    return {color: 'var(--issue-color-yellow)', width: '12px', height: '12px', iconName: 'issue-exclamation-icon'};\n  }\n  return {color: '', width: '12px', height: '12px', iconName: 'error_icon'};\n}\n\nfunction getBubbleTypePerLevel(level: Workspace.UISourceCode.Message.Level): string {\n  switch (level) {\n    case Workspace.UISourceCode.Message.Level.Error:\n      return 'error';\n    case Workspace.UISourceCode.Message.Level.Warning:\n      return 'warning';\n    case Workspace.UISourceCode.Message.Level.Issue:\n      return 'warning';\n  }\n}\n\nfunction messageLevelComparator(a: Workspace.UISourceCode.Message, b: Workspace.UISourceCode.Message): number {\n  const messageLevelPriority = {\n    [Workspace.UISourceCode.Message.Level.Issue]: 2,\n    [Workspace.UISourceCode.Message.Level.Warning]: 3,\n    [Workspace.UISourceCode.Message.Level.Error]: 4,\n  };\n  return messageLevelPriority[a.level()] - messageLevelPriority[b.level()];\n}\n\nfunction getIconDataForMessage(message: Workspace.UISourceCode.Message): IconButton.Icon.IconData {\n  if (message instanceof IssuesManager.SourceFrameIssuesManager.IssueMessage) {\n    return {\n      ...IssueCounter.IssueCounter.getIssueKindIconData(message.getIssueKind()),\n      width: '12px',\n      height: '12px',\n    };\n  }\n  return getIconDataForLevel(message.level());\n}\n\n// TODO(crbug.com/1167717): Make this a const enum again\n// eslint-disable-next-line rulesdir/const_enum\nexport enum Events {\n  ToolbarItemsChanged = 'ToolbarItemsChanged',\n}\n\nexport type EventTypes = {\n  [Events.ToolbarItemsChanged]: void,\n};\n\nconst pluginCompartment = new CodeMirror.Compartment();\n\n// Row message management and display logic. The frame manages a\n// collection of messages, organized by line (row), as a wavy\n// underline starting at the start of the first message, up to the end\n// of the line, with icons indicating the message severity and content\n// at the end of the line.\n\nfunction addMessage(rows: Workspace.UISourceCode.Message[][], message: Workspace.UISourceCode.Message):\n    Workspace.UISourceCode.Message[][] {\n  const lineNumber = message.lineNumber();\n  let i = 0;\n  for (; i < rows.length; i++) {\n    const diff = rows[i][0].lineNumber() - lineNumber;\n    if (diff === 0) {\n      rows[i] = rows[i].concat(message);\n      return rows;\n    }\n    if (diff > 0) {\n      break;\n    }\n  }\n  rows.splice(i, 0, [message]);\n  return rows;\n}\n\nfunction removeMessage(rows: Workspace.UISourceCode.Message[][], message: Workspace.UISourceCode.Message): void {\n  for (let i = 0; i < rows.length; i++) {\n    if (rows[i][0].lineNumber() === message.lineNumber()) {\n      const remaining = rows[i].filter(m => !m.isEqual(message));\n      if (remaining.length) {\n        rows[i] = remaining;\n      } else {\n        rows.splice(i, 1);\n      }\n      break;\n    }\n  }\n}\n\nclass RowMessages {\n  constructor(readonly rows: Workspace.UISourceCode.Message[][]) {\n  }\n\n  static create(messages: Workspace.UISourceCode.Message[]): RowMessages {\n    const rows: Workspace.UISourceCode.Message[][] = [];\n    for (const message of messages) {\n      addMessage(rows, message);\n    }\n    return new RowMessages(rows);\n  }\n\n  remove(message: Workspace.UISourceCode.Message): RowMessages {\n    const rows = this.rows.slice();\n    removeMessage(rows, message);\n    return new RowMessages(rows);\n  }\n\n  add(message: Workspace.UISourceCode.Message): RowMessages {\n    return new RowMessages(addMessage(this.rows.slice(), message));\n  }\n}\n\nconst setRowMessages = CodeMirror.StateEffect.define<RowMessages>();\n\nconst underlineMark = CodeMirror.Decoration.mark({class: 'cm-waveUnderline'});\n\n// The widget shown at the end of a message annotation.\nclass MessageWidget extends CodeMirror.WidgetType {\n  constructor(readonly messages: Workspace.UISourceCode.Message[]) {\n    super();\n  }\n\n  eq(other: MessageWidget): boolean {\n    return other.messages === this.messages;\n  }\n\n  toDOM(): HTMLElement {\n    const wrap = document.createElement('span');\n    wrap.classList.add('cm-messageIcon');\n    const nonIssues = this.messages.filter(msg => msg.level() !== Workspace.UISourceCode.Message.Level.Issue);\n    if (nonIssues.length) {\n      const maxIssue = nonIssues.sort(messageLevelComparator)[nonIssues.length - 1];\n      const errorIcon = wrap.appendChild(new IconButton.Icon.Icon());\n      errorIcon.data = getIconDataForLevel(maxIssue.level());\n      errorIcon.classList.add('cm-messageIcon-error');\n    }\n    const issue = this.messages.find(m => m.level() === Workspace.UISourceCode.Message.Level.Issue);\n    if (issue) {\n      const issueIcon = wrap.appendChild(new IconButton.Icon.Icon());\n      issueIcon.data = getIconDataForLevel(Workspace.UISourceCode.Message.Level.Issue);\n      issueIcon.classList.add('cm-messageIcon-issue');\n      issueIcon.addEventListener('click', () => (issue.clickHandler() || Math.min)());\n    }\n    return wrap;\n  }\n\n  ignoreEvents(): boolean {\n    return true;\n  }\n}\n\nclass RowMessageDecorations {\n  constructor(readonly messages: RowMessages, readonly decorations: CodeMirror.DecorationSet) {\n  }\n\n  static create(messages: RowMessages, doc: CodeMirror.Text): RowMessageDecorations {\n    const builder = new CodeMirror.RangeSetBuilder<CodeMirror.Decoration>();\n    for (const row of messages.rows) {\n      const line = doc.line(row[0].lineNumber() + 1);\n      const minCol = row.reduce((col, msg) => Math.min(col, msg.columnNumber() || 0), line.length);\n      if (minCol < line.length) {\n        builder.add(line.from + minCol, line.to, underlineMark);\n      }\n      builder.add(line.to, line.to, CodeMirror.Decoration.widget({side: 1, widget: new MessageWidget(row)}));\n    }\n    return new RowMessageDecorations(messages, builder.finish());\n  }\n\n  apply(tr: CodeMirror.Transaction): RowMessageDecorations {\n    let result: RowMessageDecorations = this;\n    if (tr.docChanged) {\n      result = new RowMessageDecorations(this.messages, this.decorations.map(tr.changes));\n    }\n    for (const effect of tr.effects) {\n      if (effect.is(setRowMessages)) {\n        result = RowMessageDecorations.create(effect.value, tr.state.doc);\n      }\n    }\n    return result;\n  }\n}\n\nconst showRowMessages = CodeMirror.StateField.define<RowMessageDecorations>({\n  create(state): RowMessageDecorations {\n    return RowMessageDecorations.create(new RowMessages([]), state.doc);\n  },\n  update(value, tr): RowMessageDecorations {\n    return value.apply(tr);\n  },\n  provide: field => CodeMirror.Prec.lowest(CodeMirror.EditorView.decorations.from(field, value => value.decorations)),\n});\n\nfunction countDuplicates(messages: Workspace.UISourceCode.Message[]): number[] {\n  const counts = [];\n  for (let i = 0; i < messages.length; i++) {\n    counts[i] = 0;\n    for (let j = 0; j <= i; j++) {\n      if (messages[j].isEqual(messages[i])) {\n        counts[j]++;\n        break;\n      }\n    }\n  }\n  return counts;\n}\n\nfunction renderMessage(message: Workspace.UISourceCode.Message, count: number): HTMLElement {\n  const element = document.createElement('div');\n  element.classList.add('text-editor-row-message');\n\n  if (count === 1) {\n    const icon = element.appendChild(new IconButton.Icon.Icon());\n    icon.data = getIconDataForMessage(message);\n    icon.classList.add('text-editor-row-message-icon');\n    icon.addEventListener('click', () => (message.clickHandler() || Math.min)());\n  } else {\n    const repeatCountElement =\n        document.createElement('span', {is: 'dt-small-bubble'}) as UI.UIUtils.DevToolsSmallBubble;\n    repeatCountElement.textContent = String(count);\n    repeatCountElement.classList.add('text-editor-row-message-repeat-count');\n    element.appendChild(repeatCountElement);\n    repeatCountElement.type = getBubbleTypePerLevel(message.level());\n  }\n  const linesContainer = element.createChild('div');\n  for (const line of message.text().split('\\n')) {\n    linesContainer.createChild('div').textContent = line;\n  }\n\n  return element;\n}\n\nconst rowMessageTheme = CodeMirror.EditorView.baseTheme({\n  '.cm-tooltip-message': {\n    padding: '4px',\n  },\n\n  '.cm-waveUnderline': {\n    backgroundImage: 'var(--image-file-errorWave)',\n    backgroundRepeat: 'repeat-x',\n    backgroundPosition: 'bottom',\n    paddingBottom: '1px',\n  },\n\n  '.cm-messageIcon': {\n    cursor: 'pointer',\n    '& > *': {\n      verticalAlign: 'text-bottom',\n      marginLeft: '2px',\n    },\n  },\n});\n\nfunction rowMessages(initialMessages: Workspace.UISourceCode.Message[]): CodeMirror.Extension {\n  return [\n    showRowMessages.init(\n        (state): RowMessageDecorations => RowMessageDecorations.create(RowMessages.create(initialMessages), state.doc)),\n    rowMessageTheme,\n  ];\n}\n"]}