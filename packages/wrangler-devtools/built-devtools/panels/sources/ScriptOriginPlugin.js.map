{"version":3,"file":"ScriptOriginPlugin.js","sourceRoot":"","sources":["../../../../../../front_end/panels/sources/ScriptOriginPlugin.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2018 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as SDK from '../../core/sdk/sdk.js';\nimport * as Bindings from '../../models/bindings/bindings.js';\nimport type * as Workspace from '../../models/workspace/workspace.js';\nimport * as Components from '../../ui/legacy/components/utils/utils.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport {Plugin} from './Plugin.js';\n\nconst UIStrings = {\n  /**\n  *@description Text in Script Origin Plugin of the Sources panel\n  *@example {example.com} PH1\n  */\n  sourceMappedFromS: '(source mapped from {PH1})',\n  /**\n  *@description Text in Script Origin Plugin of the Sources panel\n  *@example {http://localhost/file.wasm} PH1\n  */\n  providedViaDebugInfoByS: '(provided via debug info by {PH1})',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/sources/ScriptOriginPlugin.ts', UIStrings);\n\nexport class ScriptOriginPlugin extends Plugin {\n  static accepts(uiSourceCode: Workspace.UISourceCode.UISourceCode): boolean {\n    return uiSourceCode.contentType().hasScripts() || Boolean(ScriptOriginPlugin.script(uiSourceCode));\n  }\n\n  async rightToolbarItems(): Promise<UI.Toolbar.ToolbarItem[]> {\n    const originURLs = Bindings.CompilerScriptMapping.CompilerScriptMapping.uiSourceCodeOrigin(this.uiSourceCode);\n    if (originURLs.length) {\n      return originURLs.map(originURL => {\n        const item = i18n.i18n.getFormatLocalizedString(\n            str_, UIStrings.sourceMappedFromS, {PH1: Components.Linkifier.Linkifier.linkifyURL(originURL)});\n        return new UI.Toolbar.ToolbarItem(item);\n      });\n    }\n\n    const pluginManager = Bindings.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().pluginManager;\n    if (pluginManager) {\n      for (const originScript of pluginManager.scriptsForUISourceCode(this.uiSourceCode)) {\n        if (originScript.sourceURL) {\n          const item = i18n.i18n.getFormatLocalizedString(\n              str_, UIStrings.providedViaDebugInfoByS,\n              {PH1: Components.Linkifier.Linkifier.linkifyURL(originScript.sourceURL)});\n          return [new UI.Toolbar.ToolbarItem(item)];\n        }\n      }\n    }\n\n    // Handle anonymous scripts with an originStackTrace.\n    const script = await ScriptOriginPlugin.script(this.uiSourceCode);\n    if (!script || !script.originStackTrace) {\n      return [];\n    }\n    const link = linkifier.linkifyStackTraceTopFrame(script.debuggerModel.target(), script.originStackTrace);\n    return [new UI.Toolbar.ToolbarItem(link)];\n  }\n\n  private static async script(uiSourceCode: Workspace.UISourceCode.UISourceCode): Promise<SDK.Script.Script|null> {\n    const locations =\n        await Bindings.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().uiLocationToRawLocations(\n            uiSourceCode, 0, 0);\n    for (const location of locations) {\n      const script = location.script();\n      if (script && script.originStackTrace) {\n        return script;\n      }\n    }\n    return null;\n  }\n}\n\nexport const linkifier = new Components.Linkifier.Linkifier();\n"]}