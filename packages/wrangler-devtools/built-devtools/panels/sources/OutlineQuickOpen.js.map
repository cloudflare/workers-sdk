{"version":3,"file":"OutlineQuickOpen.js","sourceRoot":"","sources":["../../../../../../front_end/panels/sources/OutlineQuickOpen.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2017 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as Formatter from '../../models/formatter/formatter.js';\nimport type * as Workspace from '../../models/workspace/workspace.js';\nimport * as QuickOpen from '../../ui/legacy/components/quick_open/quick_open.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport {SourcesView} from './SourcesView.js';\n\nconst UIStrings = {\n  /**\n  *@description Text in Go To Line Quick Open of the Sources panel\n  */\n  noFileSelected: 'No file selected.',\n  /**\n  *@description Text in Outline Quick Open of the Sources panel\n  */\n  openAJavascriptOrCssFileToSee: 'Open a JavaScript or CSS file to see symbols',\n  /**\n  *@description Text to show no results have been found\n  */\n  noResultsFound: 'No results found',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/sources/OutlineQuickOpen.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nlet outlineQuickOpenInstance: OutlineQuickOpen;\n\nexport class OutlineQuickOpen extends QuickOpen.FilteredListWidget.Provider {\n  private items: Formatter.FormatterWorkerPool.OutlineItem[];\n  private active: boolean;\n  private constructor() {\n    super();\n    this.items = [];\n    this.active = false;\n  }\n\n  static instance(opts: {\n    forceNew: boolean|null,\n  } = {forceNew: null}): OutlineQuickOpen {\n    const {forceNew} = opts;\n    if (!outlineQuickOpenInstance || forceNew) {\n      outlineQuickOpenInstance = new OutlineQuickOpen();\n    }\n\n    return outlineQuickOpenInstance;\n  }\n\n  attach(): void {\n    this.items = [];\n    this.active = false;\n\n    const uiSourceCode = this.currentUISourceCode();\n    if (uiSourceCode) {\n      this.active = Formatter.FormatterWorkerPool.formatterWorkerPool().outlineForMimetype(\n          uiSourceCode.workingCopy(), uiSourceCode.contentType().canonicalMimeType(),\n          this.didBuildOutlineChunk.bind(this));\n    }\n  }\n\n  private didBuildOutlineChunk(isLastChunk: boolean, items: Formatter.FormatterWorkerPool.OutlineItem[]): void {\n    this.items.push(...items);\n    this.refresh();\n  }\n\n  itemCount(): number {\n    return this.items.length;\n  }\n\n  itemKeyAt(itemIndex: number): string {\n    const item = this.items[itemIndex];\n    return item.title + (item.subtitle ? item.subtitle : '');\n  }\n\n  itemScoreAt(itemIndex: number, query: string): number {\n    const item = this.items[itemIndex];\n    const methodName = query.split('(')[0];\n    if (methodName.toLowerCase() === item.title.toLowerCase()) {\n      return 1 / (1 + item.line);\n    }\n    return -item.line - 1;\n  }\n\n  renderItem(itemIndex: number, query: string, titleElement: Element, _subtitleElement: Element): void {\n    const item = this.items[itemIndex];\n    titleElement.textContent = item.title + (item.subtitle ? item.subtitle : '');\n    QuickOpen.FilteredListWidget.FilteredListWidget.highlightRanges(titleElement, query);\n\n    const tagElement = (titleElement.parentElement?.parentElement?.createChild('span', 'tag') as HTMLElement);\n    if (!tagElement) {\n      return;\n    }\n    tagElement.textContent = ':' + (item.line + 1);\n  }\n\n  selectItem(itemIndex: number|null, _promptValue: string): void {\n    if (itemIndex === null) {\n      return;\n    }\n    const uiSourceCode = this.currentUISourceCode();\n    if (!uiSourceCode) {\n      return;\n    }\n    const lineNumber = this.items[itemIndex].line;\n    if (!isNaN(lineNumber) && lineNumber >= 0) {\n      void Common.Revealer.reveal(uiSourceCode.uiLocation(lineNumber, this.items[itemIndex].column));\n    }\n  }\n\n  private currentUISourceCode(): Workspace.UISourceCode.UISourceCode|null {\n    const sourcesView = UI.Context.Context.instance().flavor(SourcesView);\n    if (!sourcesView) {\n      return null;\n    }\n    return sourcesView.currentUISourceCode();\n  }\n\n  notFoundText(): string {\n    if (!this.currentUISourceCode()) {\n      return i18nString(UIStrings.noFileSelected);\n    }\n    if (!this.active) {\n      return i18nString(UIStrings.openAJavascriptOrCssFileToSee);\n    }\n    return i18nString(UIStrings.noResultsFound);\n  }\n}\n"]}