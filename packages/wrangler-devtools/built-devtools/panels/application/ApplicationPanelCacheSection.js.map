{"version":3,"file":"ApplicationPanelCacheSection.js","sourceRoot":"","sources":["../../../../../../front_end/panels/application/ApplicationPanelCacheSection.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as Common from '../../core/common/common.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as Platform from '../../core/platform/platform.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as ApplicationComponents from './components/components.js';\nimport * as Host from '../../core/host/host.js';\n\nimport {ApplicationPanelTreeElement, ExpandableApplicationPanelTreeElement} from './ApplicationPanelTreeElement.js';\nimport type {ResourcesPanel} from './ResourcesPanel.js';\nimport {ServiceWorkerCacheView} from './ServiceWorkerCacheViews.js';\n\nconst UIStrings = {\n  /**\n  *@description Text in Application Panel Sidebar of the Application panel\n  */\n  cacheStorage: 'Cache Storage',\n  /**\n  *@description Text in Application Panel Sidebar of the Application panel\n  */\n  backForwardCache: 'Back/forward cache',\n  /**\n  *@description A context menu item in the Application Panel Sidebar of the Application panel\n  */\n  refreshCaches: 'Refresh Caches',\n  /**\n  *@description Text to delete something\n  */\n  delete: 'Delete',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/application/ApplicationPanelCacheSection.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nexport class ServiceWorkerCacheTreeElement extends ExpandableApplicationPanelTreeElement {\n  private swCacheModel: SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel|null;\n  private swCacheTreeElements: Set<SWCacheTreeElement>;\n\n  constructor(resourcesPanel: ResourcesPanel) {\n    super(resourcesPanel, i18nString(UIStrings.cacheStorage), 'CacheStorage');\n    const icon = UI.Icon.Icon.create('mediumicon-database', 'resource-tree-item');\n    this.setLink(\n        'https://developer.chrome.com/docs/devtools/storage/cache/?utm_source=devtools' as\n        Platform.DevToolsPath.UrlString);\n    this.setLeadingIcons([icon]);\n    this.swCacheModel = null;\n    this.swCacheTreeElements = new Set();\n  }\n\n  initialize(model: SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel|null): void {\n    this.swCacheTreeElements.clear();\n    this.swCacheModel = model;\n    if (model) {\n      for (const cache of model.caches()) {\n        this.addCache(model, cache);\n      }\n    }\n    SDK.TargetManager.TargetManager.instance().addModelListener(\n        SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel, SDK.ServiceWorkerCacheModel.Events.CacheAdded,\n        this.cacheAdded, this);\n    SDK.TargetManager.TargetManager.instance().addModelListener(\n        SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel, SDK.ServiceWorkerCacheModel.Events.CacheRemoved,\n        this.cacheRemoved, this);\n  }\n\n  onattach(): void {\n    super.onattach();\n    this.listItemElement.addEventListener('contextmenu', this.handleContextMenuEvent.bind(this), true);\n  }\n\n  private handleContextMenuEvent(event: MouseEvent): void {\n    const contextMenu = new UI.ContextMenu.ContextMenu(event);\n    contextMenu.defaultSection().appendItem(i18nString(UIStrings.refreshCaches), this.refreshCaches.bind(this));\n    void contextMenu.show();\n  }\n\n  private refreshCaches(): void {\n    if (this.swCacheModel) {\n      this.swCacheModel.refreshCacheNames();\n    }\n  }\n\n  private cacheAdded(event: Common.EventTarget.EventTargetEvent<SDK.ServiceWorkerCacheModel.CacheEvent>): void {\n    const {model, cache} = event.data;\n    this.addCache(model, cache);\n  }\n\n  private addCache(\n      model: SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel, cache: SDK.ServiceWorkerCacheModel.Cache): void {\n    const swCacheTreeElement = new SWCacheTreeElement(this.resourcesPanel, model, cache);\n    this.swCacheTreeElements.add(swCacheTreeElement);\n    this.appendChild(swCacheTreeElement);\n  }\n\n  private cacheRemoved(event: Common.EventTarget.EventTargetEvent<SDK.ServiceWorkerCacheModel.CacheEvent>): void {\n    const {model, cache} = event.data;\n    const swCacheTreeElement = this.cacheTreeElement(model, cache);\n    if (!swCacheTreeElement) {\n      return;\n    }\n\n    this.removeChild(swCacheTreeElement);\n    this.swCacheTreeElements.delete(swCacheTreeElement);\n    this.setExpandable(this.childCount() > 0);\n  }\n\n  private cacheTreeElement(\n      model: SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel,\n      cache: SDK.ServiceWorkerCacheModel.Cache): SWCacheTreeElement|null {\n    for (const cacheTreeElement of this.swCacheTreeElements) {\n      if (cacheTreeElement.hasModelAndCache(model, cache)) {\n        return cacheTreeElement;\n      }\n    }\n    return null;\n  }\n}\n\nexport class SWCacheTreeElement extends ApplicationPanelTreeElement {\n  private readonly model: SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel;\n  private cache: SDK.ServiceWorkerCacheModel.Cache;\n  private view: ServiceWorkerCacheView|null;\n\n  constructor(\n      resourcesPanel: ResourcesPanel, model: SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel,\n      cache: SDK.ServiceWorkerCacheModel.Cache) {\n    super(resourcesPanel, cache.cacheName + ' - ' + cache.securityOrigin, false);\n    this.model = model;\n    this.cache = cache;\n    this.view = null;\n    const icon = UI.Icon.Icon.create('mediumicon-table', 'resource-tree-item');\n    this.setLeadingIcons([icon]);\n  }\n\n  get itemURL(): Platform.DevToolsPath.UrlString {\n    // I don't think this will work at all.\n    return 'cache://' + this.cache.cacheId as Platform.DevToolsPath.UrlString;\n  }\n\n  onattach(): void {\n    super.onattach();\n    this.listItemElement.addEventListener('contextmenu', this.handleContextMenuEvent.bind(this), true);\n  }\n\n  private handleContextMenuEvent(event: MouseEvent): void {\n    const contextMenu = new UI.ContextMenu.ContextMenu(event);\n    contextMenu.defaultSection().appendItem(i18nString(UIStrings.delete), this.clearCache.bind(this));\n    void contextMenu.show();\n  }\n\n  private clearCache(): void {\n    void this.model.deleteCache(this.cache);\n  }\n\n  update(cache: SDK.ServiceWorkerCacheModel.Cache): void {\n    this.cache = cache;\n    if (this.view) {\n      this.view.update(cache);\n    }\n  }\n\n  onselect(selectedByUser: boolean|undefined): boolean {\n    super.onselect(selectedByUser);\n    if (!this.view) {\n      this.view = new ServiceWorkerCacheView(this.model, this.cache);\n    }\n\n    this.showView(this.view);\n    Host.userMetrics.panelShown(Host.UserMetrics.PanelCodes[Host.UserMetrics.PanelCodes.service_worker_cache]);\n    return false;\n  }\n\n  hasModelAndCache(\n      model: SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel, cache: SDK.ServiceWorkerCacheModel.Cache): boolean {\n    return this.cache.equals(cache) && this.model === model;\n  }\n}\n\nexport class BackForwardCacheTreeElement extends ApplicationPanelTreeElement {\n  private view?: ApplicationComponents.BackForwardCacheView.BackForwardCacheViewWrapper;\n\n  constructor(resourcesPanel: ResourcesPanel) {\n    super(resourcesPanel, i18nString(UIStrings.backForwardCache), false);\n    const icon = UI.Icon.Icon.create('mediumicon-database', 'resource-tree-item');\n    this.setLeadingIcons([icon]);\n  }\n\n  get itemURL(): Platform.DevToolsPath.UrlString {\n    return 'bfcache://' as Platform.DevToolsPath.UrlString;\n  }\n\n  onselect(selectedByUser?: boolean): boolean {\n    super.onselect(selectedByUser);\n    if (!this.view) {\n      this.view = new ApplicationComponents.BackForwardCacheView.BackForwardCacheViewWrapper();\n    }\n    this.showView(this.view);\n    Host.userMetrics.panelShown(Host.UserMetrics.PanelCodes[Host.UserMetrics.PanelCodes.back_forward_cache]);\n    return false;\n  }\n}\n"]}