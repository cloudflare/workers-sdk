{"version":3,"file":"DatabaseQueryView.js","sourceRoot":"","sources":["../../../../../../front_end/panels/application/DatabaseQueryView.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/*\n * Copyright (C) 2008 Apple Inc. All Rights Reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n * 1. Redistributions of source code must retain the above copyright\n *    notice, this list of conditions and the following disclaimer.\n * 2. Redistributions in binary form must reproduce the above copyright\n *    notice, this list of conditions and the following disclaimer in the\n *    documentation and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS'' AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR\n * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport * as Common from '../../core/common/common.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport * as DataGrid from '../../ui/legacy/components/data_grid/data_grid.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport type {Database} from './DatabaseModel.js';\n\nconst UIStrings = {\n  /**\n  *@description Data grid name for Database Query data grids\n  */\n  databaseQuery: 'Database Query',\n  /**\n  *@description Aria text for table selected in WebSQL DatabaseQueryView in Application panel\n  *@example {\"SELECT * FROM LOGS\"} PH1\n  */\n  queryS: 'Query: {PH1}',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/application/DatabaseQueryView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nexport class DatabaseQueryView extends Common.ObjectWrapper.eventMixin<EventTypes, typeof UI.Widget.VBox>(\n    UI.Widget.VBox) {\n  database: Database;\n  private queryWrapper: HTMLElement;\n  private readonly promptContainer: HTMLElement;\n  private readonly promptElement: HTMLElement;\n  private prompt: UI.TextPrompt.TextPrompt;\n  private readonly proxyElement: Element;\n  private queryResults: HTMLElement[];\n  private virtualSelectedIndex: number;\n  private lastSelectedElement!: Element|null;\n  private selectionTimeout: number;\n  constructor(database: Database) {\n    super();\n\n    this.database = database;\n\n    this.element.classList.add('storage-view', 'query', 'monospace');\n    this.element.addEventListener('selectstart', this.selectStart.bind(this), false);\n\n    this.queryWrapper = this.element.createChild('div', 'database-query-group-messages');\n    this.queryWrapper.addEventListener('focusin', (this.onFocusIn.bind(this) as EventListener));\n    this.queryWrapper.addEventListener('focusout', (this.onFocusOut.bind(this) as EventListener));\n    this.queryWrapper.addEventListener('keydown', (this.onKeyDown.bind(this) as EventListener));\n    this.queryWrapper.tabIndex = -1;\n\n    this.promptContainer = this.element.createChild('div', 'database-query-prompt-container');\n    this.promptContainer.appendChild(UI.Icon.Icon.create('smallicon-text-prompt', 'prompt-icon'));\n    this.promptElement = this.promptContainer.createChild('div');\n    this.promptElement.className = 'database-query-prompt';\n    this.promptElement.addEventListener('keydown', (this.promptKeyDown.bind(this) as EventListener));\n\n    this.prompt = new UI.TextPrompt.TextPrompt();\n    this.prompt.initialize(this.completions.bind(this), ' ');\n    this.proxyElement = this.prompt.attach(this.promptElement);\n\n    this.element.addEventListener('click', this.messagesClicked.bind(this), true);\n\n    this.queryResults = [];\n    this.virtualSelectedIndex = -1;\n    this.selectionTimeout = 0;\n  }\n\n  private messagesClicked(): void {\n    this.prompt.focus();\n    if (!this.prompt.isCaretInsidePrompt() && !this.element.hasSelection()) {\n      this.prompt.moveCaretToEndOfPrompt();\n    }\n  }\n\n  private onKeyDown(event: KeyboardEvent): void {\n    if (UI.UIUtils.isEditing() || !this.queryResults.length || event.shiftKey) {\n      return;\n    }\n    switch (event.key) {\n      case 'ArrowUp':\n        if (this.virtualSelectedIndex > 0) {\n          this.virtualSelectedIndex--;\n        } else {\n          return;\n        }\n        break;\n      case 'ArrowDown':\n        if (this.virtualSelectedIndex < this.queryResults.length - 1) {\n          this.virtualSelectedIndex++;\n        } else {\n          return;\n        }\n        break;\n      case 'Home':\n        this.virtualSelectedIndex = 0;\n        break;\n      case 'End':\n        this.virtualSelectedIndex = this.queryResults.length - 1;\n        break;\n      default:\n        return;\n    }\n    event.consume(true);\n    this.updateFocusedItem();\n  }\n\n  private onFocusIn(event: FocusEvent): void {\n    // Make default selection when moving from external (e.g. prompt) to the container.\n    if (this.virtualSelectedIndex === -1 && this.isOutsideViewport((event.relatedTarget as Element | null)) &&\n        event.target === this.queryWrapper && this.queryResults.length) {\n      this.virtualSelectedIndex = this.queryResults.length - 1;\n    }\n    this.updateFocusedItem();\n  }\n\n  private onFocusOut(event: FocusEvent): void {\n    if (this.isOutsideViewport((event.relatedTarget as Element | null))) {\n      this.virtualSelectedIndex = -1;\n    }\n    this.updateFocusedItem();\n\n    this.queryWrapper.scrollTop = 10000000;\n  }\n\n  private isOutsideViewport(element: Element|null): boolean {\n    return element !== null && !element.isSelfOrDescendant(this.queryWrapper);\n  }\n\n  private updateFocusedItem(): void {\n    let index: number = this.virtualSelectedIndex;\n    if (this.queryResults.length && this.virtualSelectedIndex < 0) {\n      index = this.queryResults.length - 1;\n    }\n\n    const selectedElement = index >= 0 ? this.queryResults[index] : null;\n    const changed = this.lastSelectedElement !== selectedElement;\n    const containerHasFocus = this.queryWrapper === Platform.DOMUtilities.deepActiveElement(this.element.ownerDocument);\n\n    if (selectedElement && (changed || containerHasFocus) && this.element.hasFocus()) {\n      if (!selectedElement.hasFocus()) {\n        selectedElement.focus();\n      }\n    }\n\n    if (this.queryResults.length && !this.queryWrapper.hasFocus()) {\n      this.queryWrapper.tabIndex = 0;\n    } else {\n      this.queryWrapper.tabIndex = -1;\n    }\n    this.lastSelectedElement = selectedElement;\n  }\n\n  async completions(_expression: string, prefix: string, _force?: boolean): Promise<UI.SuggestBox.Suggestions> {\n    if (!prefix) {\n      return [];\n    }\n\n    prefix = prefix.toLowerCase();\n    const tableNames = await this.database.tableNames();\n    return tableNames.map(name => name + ' ')\n        .concat(SQL_BUILT_INS)\n        .filter(proposal => proposal.toLowerCase().startsWith(prefix))\n        .map(completion => ({text: completion} as UI.SuggestBox.Suggestion));\n  }\n\n  private selectStart(_event: Event): void {\n    if (this.selectionTimeout) {\n      clearTimeout(this.selectionTimeout);\n    }\n\n    this.prompt.clearAutocomplete();\n\n    function moveBackIfOutside(this: DatabaseQueryView): void {\n      this.selectionTimeout = 0;\n      if (!this.prompt.isCaretInsidePrompt() && !this.element.hasSelection()) {\n        this.prompt.moveCaretToEndOfPrompt();\n      }\n      this.prompt.autoCompleteSoon();\n    }\n\n    this.selectionTimeout = window.setTimeout(moveBackIfOutside.bind(this), 100);\n  }\n\n  private promptKeyDown(event: KeyboardEvent): void {\n    if (event.key === 'Enter') {\n      void this.enterKeyPressed(event);\n      return;\n    }\n  }\n\n  private async enterKeyPressed(event: KeyboardEvent): Promise<void> {\n    event.consume(true);\n\n    const query = this.prompt.textWithCurrentSuggestion();\n    this.prompt.clearAutocomplete();\n\n    if (!query.length) {\n      return;\n    }\n\n    this.prompt.setEnabled(false);\n    try {\n      // TODO(crbug.com/1172300) Ignored during the jsdoc to ts migration)\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const result = await new Promise<{columnNames: string[], values: any[]}>((resolve, reject) => {\n        void this.database.executeSql(\n            query, (columnNames, values) => resolve({columnNames, values}), errorText => reject(errorText));\n      });\n      this.queryFinished(query, result.columnNames, result.values);\n    } catch (e) {\n      this.appendErrorQueryResult(query, e);\n    }\n    this.prompt.setEnabled(true);\n    this.prompt.setText('');\n    this.prompt.focus();\n  }\n\n  // TODO(crbug.com/1172300) Ignored during the jsdoc to ts migration)\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private queryFinished(query: string, columnNames: string[], values: any[]): void {\n    const dataGrid =\n        DataGrid.SortableDataGrid.SortableDataGrid.create(columnNames, values, i18nString(UIStrings.databaseQuery));\n    const trimmedQuery = query.trim();\n\n    let view: DataGrid.DataGrid.DataGridWidget<unknown>|null = null;\n    if (dataGrid) {\n      dataGrid.setStriped(true);\n      dataGrid.renderInline();\n      dataGrid.autoSizeColumns(5);\n      view = dataGrid.asWidget();\n      dataGrid.setFocusable(false);\n    }\n    this.appendViewQueryResult(trimmedQuery, view);\n\n    if (trimmedQuery.match(/^create /i) || trimmedQuery.match(/^drop table /i)) {\n      this.dispatchEventToListeners(Events.SchemaUpdated, this.database);\n    }\n  }\n\n  private appendViewQueryResult(query: string, view: UI.Widget.Widget|null): void {\n    const resultElement = this.appendQueryResult(query);\n    if (view) {\n      view.show(resultElement);\n    } else {\n      resultElement.remove();\n    }\n\n    this.scrollResultIntoView();\n  }\n\n  private appendErrorQueryResult(query: string, errorText: string): void {\n    const resultElement = this.appendQueryResult(query);\n    resultElement.classList.add('error');\n    resultElement.appendChild(UI.Icon.Icon.create('smallicon-error', 'prompt-icon'));\n    UI.UIUtils.createTextChild(resultElement, errorText);\n\n    this.scrollResultIntoView();\n  }\n\n  private scrollResultIntoView(): void {\n    this.queryResults[this.queryResults.length - 1].scrollIntoView(false);\n    this.promptElement.scrollIntoView(false);\n  }\n\n  private appendQueryResult(query: string): HTMLDivElement {\n    const element = document.createElement('div');\n    element.className = 'database-user-query';\n    element.tabIndex = -1;\n\n    UI.ARIAUtils.setAccessibleName(element, i18nString(UIStrings.queryS, {PH1: query}));\n    this.queryResults.push(element);\n    this.updateFocusedItem();\n\n    element.appendChild(UI.Icon.Icon.create('smallicon-user-command', 'prompt-icon'));\n\n    const commandTextElement = document.createElement('span');\n    commandTextElement.className = 'database-query-text';\n    commandTextElement.textContent = query;\n    element.appendChild(commandTextElement);\n\n    const resultElement = document.createElement('div');\n    resultElement.className = 'database-query-result';\n    element.appendChild(resultElement);\n\n    this.queryWrapper.appendChild(element);\n    return resultElement;\n  }\n}\n\n// TODO(crbug.com/1167717): Make this a const enum again\n// eslint-disable-next-line rulesdir/const_enum\nexport enum Events {\n  SchemaUpdated = 'SchemaUpdated',\n}\n\nexport type EventTypes = {\n  [Events.SchemaUpdated]: Database,\n};\n\nexport const SQL_BUILT_INS = [\n  'SELECT ',\n  'FROM ',\n  'WHERE ',\n  'LIMIT ',\n  'DELETE FROM ',\n  'CREATE ',\n  'DROP ',\n  'TABLE ',\n  'INDEX ',\n  'UPDATE ',\n  'INSERT INTO ',\n  'VALUES (',\n];\n"]}