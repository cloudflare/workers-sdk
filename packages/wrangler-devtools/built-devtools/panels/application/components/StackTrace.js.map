{"version":3,"file":"StackTrace.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/application/components/StackTrace.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport type * as SDK from '../../../core/sdk/sdk.js';\nimport * as ExpandableList from '../../../ui/components/expandable_list/expandable_list.js';\nimport * as ComponentHelpers from '../../../ui/components/helpers/helpers.js';\nimport * as Components from '../../../ui/legacy/components/utils/utils.js';\nimport * as LitHtml from '../../../ui/lit-html/lit-html.js';\nimport type * as Protocol from '../../../generated/protocol.js';\n\nimport stackTraceRowStyles from './stackTraceRow.css.js';\nimport stackTraceLinkButtonStyles from './stackTraceLinkButton.css.js';\n\nconst UIStrings = {\n  /**\n  *@description Error message stating that something went wrong when tring to render stack trace\n  */\n  cannotRenderStackTrace: 'Cannot render stack trace',\n  /**\n  *@description A link to show more frames in the stack trace if more are available. Never 0.\n  */\n  showSMoreFrames: '{n, plural, =1 {Show # more frame} other {Show # more frames}}',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/application/components/StackTrace.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport interface StackTraceData {\n  frame: SDK.ResourceTreeModel.ResourceTreeFrame;\n  buildStackTraceRows: (\n      stackTrace: Protocol.Runtime.StackTrace,\n      target: SDK.Target.Target|null,\n      linkifier: Components.Linkifier.Linkifier,\n      tabStops: boolean|undefined,\n      updateCallback?: (arg0: (Components.JSPresentationUtils.StackTraceRegularRow|\n                               Components.JSPresentationUtils.StackTraceAsyncRow)[]) => void,\n      ) => (Components.JSPresentationUtils.StackTraceRegularRow | Components.JSPresentationUtils.StackTraceAsyncRow)[];\n}\n\ninterface StackTraceRowData {\n  stackTraceRowItem: Components.JSPresentationUtils.StackTraceRegularRow;\n}\n\nexport class StackTraceRow extends HTMLElement {\n  static readonly litTagName = LitHtml.literal`devtools-stack-trace-row`;\n  readonly #shadow = this.attachShadow({mode: 'open'});\n\n  #stackTraceRowItem: Components.JSPresentationUtils.StackTraceRegularRow|null = null;\n\n  set data(data: StackTraceRowData) {\n    this.#stackTraceRowItem = data.stackTraceRowItem;\n    this.#render();\n  }\n\n  connectedCallback(): void {\n    this.#shadow.adoptedStyleSheets = [stackTraceRowStyles];\n  }\n\n  #render(): void {\n    if (!this.#stackTraceRowItem) {\n      return;\n    }\n    LitHtml.render(\n        LitHtml.html`\n      <div class=\"stack-trace-row\">\n              <div class=\"stack-trace-function-name text-ellipsis\" title=${this.#stackTraceRowItem.functionName}>\n                ${this.#stackTraceRowItem.functionName}\n              </div>\n              <div class=\"stack-trace-source-location\">\n                ${\n            this.#stackTraceRowItem.link ?\n                LitHtml.html`<div class=\"text-ellipsis\">\\xA0@\\xA0${this.#stackTraceRowItem.link}</div>` :\n                LitHtml.nothing}\n              </div>\n            </div>\n    `,\n        this.#shadow, {host: this});\n  }\n}\n\ninterface StackTraceLinkButtonData {\n  onShowAllClick: () => void;\n  hiddenCallFramesCount: number;\n}\n\nexport class StackTraceLinkButton extends HTMLElement {\n  static readonly litTagName = LitHtml.literal`devtools-stack-trace-link-button`;\n  readonly #shadow = this.attachShadow({mode: 'open'});\n\n  #onShowAllClick: () => void = () => {};\n  #hiddenCallFramesCount: number|null = null;\n\n  set data(data: StackTraceLinkButtonData) {\n    this.#onShowAllClick = data.onShowAllClick;\n    this.#hiddenCallFramesCount = data.hiddenCallFramesCount;\n    this.#render();\n  }\n\n  connectedCallback(): void {\n    this.#shadow.adoptedStyleSheets = [stackTraceLinkButtonStyles];\n  }\n\n  #render(): void {\n    if (!this.#hiddenCallFramesCount) {\n      return;\n    }\n\n    LitHtml.render(\n        LitHtml.html`\n      <div class=\"stack-trace-row\">\n          <button class=\"link\" @click=${(): void => this.#onShowAllClick()}>\n            ${i18nString(UIStrings.showSMoreFrames, {\n          n: this.#hiddenCallFramesCount,\n        })}\n          </button>\n        </div>\n    `,\n        this.#shadow, {host: this});\n  }\n}\n\nexport class StackTrace extends HTMLElement {\n  static readonly litTagName = LitHtml.literal`devtools-resources-stack-trace`;\n\n  readonly #shadow = this.attachShadow({mode: 'open'});\n  readonly #linkifier = new Components.Linkifier.Linkifier();\n  #stackTraceRows: (Components.JSPresentationUtils.StackTraceRegularRow|\n                    Components.JSPresentationUtils.StackTraceAsyncRow)[] = [];\n  #showHidden = false;\n\n  set data(data: StackTraceData) {\n    const frame = data.frame;\n    const {creationStackTrace, creationStackTraceTarget} = frame.getCreationStackTraceData();\n    if (creationStackTrace) {\n      this.#stackTraceRows = data.buildStackTraceRows(\n          creationStackTrace, creationStackTraceTarget, this.#linkifier, true,\n          this.#onStackTraceRowsUpdated.bind(this));\n    }\n    this.#render();\n  }\n\n  #onStackTraceRowsUpdated(stackTraceRows: (Components.JSPresentationUtils.StackTraceRegularRow|\n                                            Components.JSPresentationUtils.StackTraceAsyncRow)[]): void {\n    this.#stackTraceRows = stackTraceRows;\n    this.#render();\n  }\n\n  #onShowAllClick(): void {\n    this.#showHidden = true;\n    this.#render();\n  }\n\n  createRowTemplates(): LitHtml.TemplateResult[] {\n    const expandableRows = [];\n    let hiddenCallFramesCount = 0;\n    for (const item of this.#stackTraceRows) {\n      if (this.#showHidden || (!item.ignoreListHide && !item.rowCountHide)) {\n        if ('functionName' in item) {\n          expandableRows.push(LitHtml.html`\n          <${StackTraceRow.litTagName} data-stack-trace-row .data=${{\n            stackTraceRowItem: item,\n          } as StackTraceRowData}></${StackTraceRow.litTagName}>`);\n        }\n        if ('asyncDescription' in item) {\n          expandableRows.push(LitHtml.html`\n            <div>${item.asyncDescription}</div>\n          `);\n        }\n      }\n      if (!this.#showHidden && 'functionName' in item && (item.ignoreListHide || item.rowCountHide)) {\n        hiddenCallFramesCount++;\n      }\n    }\n    if (hiddenCallFramesCount) {\n      // Disabled until https://crbug.com/1079231 is fixed.\n      // clang-format off\n      expandableRows.push(LitHtml.html`\n      <${StackTraceLinkButton.litTagName} data-stack-trace-row .data=${{onShowAllClick: this.#onShowAllClick.bind(this), hiddenCallFramesCount: hiddenCallFramesCount} as StackTraceLinkButtonData}></${StackTraceLinkButton.litTagName}>\n      `);\n      // clang-format on\n    }\n\n    return expandableRows;\n  }\n\n  #render(): void {\n    if (!this.#stackTraceRows.length) {\n      // Disabled until https://crbug.com/1079231 is fixed.\n      // clang-format off\n      LitHtml.render(\n        LitHtml.html`\n          <span>${i18nString(UIStrings.cannotRenderStackTrace)}</span>\n        `,\n        this.#shadow, {host: this});\n      return;\n    }\n    const expandableRows = this.createRowTemplates();\n    LitHtml.render(\n      LitHtml.html`\n        <${ExpandableList.ExpandableList.ExpandableList.litTagName} .data=${{\n          rows: expandableRows,\n        } as ExpandableList.ExpandableList.ExpandableListData}>\n        </${ExpandableList.ExpandableList.ExpandableList.litTagName}>\n      `,\n      this.#shadow, {host: this});\n    // clang-format on\n  }\n}\n\nComponentHelpers.CustomElements.defineComponent('devtools-stack-trace-row', StackTraceRow);\nComponentHelpers.CustomElements.defineComponent('devtools-stack-trace-link-button', StackTraceLinkButton);\nComponentHelpers.CustomElements.defineComponent('devtools-resources-stack-trace', StackTrace);\n\ndeclare global {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  interface HTMLElementTagNameMap {\n    'devtools-stack-trace-row': StackTraceRow;\n    'devtools-stack-trace-link-button': StackTraceLinkButton;\n    'devtools-resources-stack-trace': StackTrace;\n  }\n}\n"]}