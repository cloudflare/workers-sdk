{"version":3,"file":"AttributionReportingIssueDetailsView.js","sourceRoot":"","sources":["../../../../../../front_end/panels/issues/AttributionReportingIssueDetailsView.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as Protocol from '../../generated/protocol.js';\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as IssuesManager from '../../models/issues_manager/issues_manager.js';\n\nimport {AffectedItem, AffectedResourcesView} from './AffectedResourcesView.js';\n\nconst UIStrings = {\n  /**\n   * @description Label for number of rows in the issue details table.\n   */\n  nViolations: '{n, plural, =1 {# violation} other {# violations}}',\n  /**\n   * @description Noun, label for the column showing the associated frame in the issue details table.\n   * The associated frame can either be the \"main frame\" (or main window), or an HTML iframe.\n   */\n  frame: 'Frame',\n  /**\n   * @description Noun, label for the column showing the associated HTML element in the issue details table.\n   */\n  element: 'Element',\n  /**\n   * @description Noun, label for the column showing the invalid header value in the issue details table.\n   */\n  invalidHeaderValue: 'Invalid Header Value',\n  /**\n   * @description Noun, label for the column showing the associated network request in the issue details table.\n   */\n  request: 'Request',\n  /**\n   * @description Label for the column showing the invalid URL used in an HTML anchor element (\"a link\").\n   * A origin is (roughly said) the front part of a URL.\n   */\n  untrustworthyOrigin: 'Untrustworthy origin',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/issues/AttributionReportingIssueDetailsView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport class AttributionReportingIssueDetailsView extends AffectedResourcesView {\n  protected override getResourceNameWithCount(count: number): string {\n    return i18nString(UIStrings.nViolations, {n: count});\n  }\n\n  override update(): void {\n    this.clear();\n    const issues = this.issue.getAttributionReportingIssues();\n    if (issues.size > 0) {\n      this.#appendDetails(issues.values().next().value.code(), issues);\n    } else {\n      this.updateAffectedResourceCount(0);\n    }\n  }\n\n  #appendDetails(\n      issueCode: IssuesManager.AttributionReportingIssue.IssueCode,\n      issues: Iterable<IssuesManager.AttributionReportingIssue.AttributionReportingIssue>): void {\n    const header = document.createElement('tr');\n    switch (issueCode) {\n      case IssuesManager.AttributionReportingIssue.IssueCode.AttributionUntrustworthyFrameOrigin:\n        this.appendColumnTitle(header, i18nString(UIStrings.frame));\n        this.appendColumnTitle(header, i18nString(UIStrings.request));\n        this.appendColumnTitle(header, i18nString(UIStrings.untrustworthyOrigin));\n        break;\n      case IssuesManager.AttributionReportingIssue.IssueCode.AttributionUntrustworthyOrigin:\n        this.appendColumnTitle(header, i18nString(UIStrings.request));\n        this.appendColumnTitle(header, i18nString(UIStrings.untrustworthyOrigin));\n        break;\n      case IssuesManager.AttributionReportingIssue.IssueCode.AttributionSourceUntrustworthyFrameOrigin:\n        this.appendColumnTitle(header, i18nString(UIStrings.frame));\n        this.appendColumnTitle(header, i18nString(UIStrings.element));\n        this.appendColumnTitle(header, i18nString(UIStrings.untrustworthyOrigin));\n        break;\n      case IssuesManager.AttributionReportingIssue.IssueCode.AttributionSourceUntrustworthyOrigin:\n        this.appendColumnTitle(header, i18nString(UIStrings.element));\n        this.appendColumnTitle(header, i18nString(UIStrings.untrustworthyOrigin));\n        break;\n      case IssuesManager.AttributionReportingIssue.IssueCode.InvalidHeader:\n        this.appendColumnTitle(header, i18nString(UIStrings.frame));\n        this.appendColumnTitle(header, i18nString(UIStrings.request));\n        this.appendColumnTitle(header, i18nString(UIStrings.invalidHeaderValue));\n        break;\n      case IssuesManager.AttributionReportingIssue.IssueCode.PermissionPolicyDisabled:\n        this.appendColumnTitle(header, i18nString(UIStrings.frame));\n        this.appendColumnTitle(header, i18nString(UIStrings.element));\n        this.appendColumnTitle(header, i18nString(UIStrings.request));\n        break;\n    }\n\n    this.affectedResources.appendChild(header);\n    let count = 0;\n    for (const issue of issues) {\n      count++;\n      void this.#appendDetail(issueCode, issue);\n    }\n    this.updateAffectedResourceCount(count);\n  }\n\n  async #appendDetail(\n      issueCode: IssuesManager.AttributionReportingIssue.IssueCode,\n      issue: IssuesManager.AttributionReportingIssue.AttributionReportingIssue): Promise<void> {\n    const element = document.createElement('tr');\n    element.classList.add('affected-resource-directive');\n\n    const details = issue.issueDetails;\n\n    switch (issueCode) {\n      case IssuesManager.AttributionReportingIssue.IssueCode.AttributionSourceUntrustworthyOrigin:\n        await this.#appendElementOrEmptyCell(element, issue);\n        this.appendIssueDetailCell(element, details.invalidParameter || '');\n        break;\n      case IssuesManager.AttributionReportingIssue.IssueCode.AttributionUntrustworthyOrigin:\n        this.#appendRequestOrEmptyCell(element, details.request);\n        this.appendIssueDetailCell(element, details.invalidParameter || '');\n        break;\n      case IssuesManager.AttributionReportingIssue.IssueCode.InvalidHeader:\n        this.#appendFrameOrEmptyCell(element, issue);\n        this.#appendRequestOrEmptyCell(element, details.request);\n        this.appendIssueDetailCell(element, details.invalidParameter || '');\n        break;\n      case IssuesManager.AttributionReportingIssue.IssueCode.PermissionPolicyDisabled:\n        this.#appendFrameOrEmptyCell(element, issue);\n        await this.#appendElementOrEmptyCell(element, issue);\n        this.#appendRequestOrEmptyCell(element, details.request);\n        break;\n    }\n\n    this.affectedResources.appendChild(element);\n  }\n\n  #appendFrameOrEmptyCell(\n      parent: HTMLElement, issue: IssuesManager.AttributionReportingIssue.AttributionReportingIssue): void {\n    const details = issue.issueDetails;\n    if (details.frame) {\n      parent.appendChild(this.createFrameCell(details.frame.frameId, issue.getCategory()));\n    } else {\n      this.appendIssueDetailCell(parent, '');\n    }\n  }\n\n  async #appendElementOrEmptyCell(\n      parent: HTMLElement, issue: IssuesManager.AttributionReportingIssue.AttributionReportingIssue): Promise<void> {\n    const details = issue.issueDetails;\n    if (details.violatingNodeId !== undefined) {\n      const target = issue.model()?.target() || null;\n      parent.appendChild(await this.createElementCell(\n          {backendNodeId: details.violatingNodeId, target, nodeName: 'Attribution source element'},\n          issue.getCategory()));\n    } else {\n      this.appendIssueDetailCell(parent, '');\n    }\n  }\n\n  #appendRequestOrEmptyCell(parent: HTMLElement, request?: Protocol.Audits.AffectedRequest): void {\n    if (!request) {\n      this.appendIssueDetailCell(parent, '');\n      return;\n    }\n\n    const opts = {\n      additionalOnClickAction(): void {\n        Host.userMetrics.issuesPanelResourceOpened(\n            IssuesManager.Issue.IssueCategory.AttributionReporting, AffectedItem.Request);\n      },\n    };\n    parent.appendChild(this.createRequestCell(request, opts));\n  }\n}\n"]}