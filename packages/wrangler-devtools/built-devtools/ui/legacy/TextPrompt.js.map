{"version":3,"file":"TextPrompt.js","sourceRoot":"","sources":["../../../../../../front_end/ui/legacy/TextPrompt.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/*\n * Copyright (C) 2008 Apple Inc.  All rights reserved.\n * Copyright (C) 2011 Google Inc.  All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * 1.  Redistributions of source code must retain the above copyright\n *     notice, this list of conditions and the following disclaimer.\n * 2.  Redistributions in binary form must reproduce the above copyright\n *     notice, this list of conditions and the following disclaimer in the\n *     documentation and/or other materials provided with the distribution.\n * 3.  Neither the name of Apple Computer, Inc. (\"Apple\") nor the names of\n *     its contributors may be used to endorse or promote products derived\n *     from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS \"AS IS\" AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport * as Common from '../../core/common/common.js';\nimport * as DOMExtension from '../../core/dom_extension/dom_extension.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport * as TextUtils from '../../models/text_utils/text_utils.js';\n\nimport * as ARIAUtils from './ARIAUtils.js';\nimport * as ThemeSupport from './theme_support/theme_support.js';\n\nimport type {SuggestBoxDelegate, Suggestion} from './SuggestBox.js';\nimport {SuggestBox} from './SuggestBox.js';\nimport {Tooltip} from './Tooltip.js';\nimport {ElementFocusRestorer} from './UIUtils.js';\nimport textPromptStyles from './textPrompt.css.legacy.js';\n\nexport class TextPrompt extends Common.ObjectWrapper.ObjectWrapper<EventTypes> implements SuggestBoxDelegate {\n  private proxyElement!: HTMLElement|undefined;\n  private proxyElementDisplay: string;\n  private autocompletionTimeout: number;\n  private titleInternal: string;\n  private queryRange: TextUtils.TextRange.TextRange|null;\n  private previousText: string;\n  private currentSuggestion: Suggestion|null;\n  private completionRequestId: number;\n  private ghostTextElement: HTMLSpanElement;\n  private leftParenthesesIndices: number[];\n  private loadCompletions!: (this: null, arg1: string, arg2: string, arg3?: boolean|undefined) => Promise<Suggestion[]>;\n  private completionStopCharacters!: string;\n  private usesSuggestionBuilder!: boolean;\n  private elementInternal?: Element;\n  private boundOnKeyDown?: ((ev: Event) => void);\n  private boundOnInput?: ((ev: Event) => void);\n  private boundOnMouseWheel?: ((event: Event) => void);\n  private boundClearAutocomplete?: (() => void);\n  private contentElement?: HTMLElement;\n  private suggestBox?: SuggestBox;\n  private isEditing?: boolean;\n  private focusRestorer?: ElementFocusRestorer;\n  private blurListener?: ((arg0: Event) => void);\n  private oldTabIndex?: number;\n  private completeTimeout?: number;\n  private disableDefaultSuggestionForEmptyInputInternal?: boolean;\n\n  constructor() {\n    super();\n    this.proxyElementDisplay = 'inline-block';\n    this.autocompletionTimeout = DefaultAutocompletionTimeout;\n    this.titleInternal = '';\n    this.queryRange = null;\n    this.previousText = '';\n    this.currentSuggestion = null;\n    this.completionRequestId = 0;\n    this.ghostTextElement = document.createElement('span');\n    this.ghostTextElement.classList.add('auto-complete-text');\n    this.ghostTextElement.setAttribute('contenteditable', 'false');\n    this.leftParenthesesIndices = [];\n    ARIAUtils.markAsHidden(this.ghostTextElement);\n  }\n\n  initialize(\n      completions: (this: null, arg1: string, arg2: string, arg3?: boolean|undefined) => Promise<Suggestion[]>,\n      stopCharacters?: string, usesSuggestionBuilder?: boolean): void {\n    this.loadCompletions = completions;\n    this.completionStopCharacters = stopCharacters || ' =:[({;,!+-*/&|^<>.';\n    this.usesSuggestionBuilder = usesSuggestionBuilder || false;\n  }\n\n  setAutocompletionTimeout(timeout: number): void {\n    this.autocompletionTimeout = timeout;\n  }\n\n  renderAsBlock(): void {\n    this.proxyElementDisplay = 'block';\n  }\n\n  /**\n   * Clients should never attach any event listeners to the |element|. Instead,\n   * they should use the result of this method to attach listeners for bubbling events.\n   */\n  attach(element: Element): Element {\n    return this.attachInternal(element);\n  }\n\n  /**\n   * Clients should never attach any event listeners to the |element|. Instead,\n   * they should use the result of this method to attach listeners for bubbling events\n   * or the |blurListener| parameter to register a \"blur\" event listener on the |element|\n   * (since the \"blur\" event does not bubble.)\n   */\n  attachAndStartEditing(element: Element, blurListener: (arg0: Event) => void): Element {\n    const proxyElement = this.attachInternal(element);\n    this.startEditing(blurListener);\n    return proxyElement;\n  }\n\n  private attachInternal(element: Element): Element {\n    if (this.proxyElement) {\n      throw 'Cannot attach an attached TextPrompt';\n    }\n    this.elementInternal = element;\n\n    this.boundOnKeyDown = this.onKeyDown.bind(this);\n    this.boundOnInput = this.onInput.bind(this);\n    this.boundOnMouseWheel = this.onMouseWheel.bind(this);\n    this.boundClearAutocomplete = this.clearAutocomplete.bind(this);\n    this.proxyElement = element.ownerDocument.createElement('span');\n    ThemeSupport.ThemeSupport.instance().appendStyle(this.proxyElement, textPromptStyles);\n    this.contentElement = this.proxyElement.createChild('div', 'text-prompt-root');\n    this.proxyElement.style.display = this.proxyElementDisplay;\n    if (element.parentElement) {\n      element.parentElement.insertBefore(this.proxyElement, element);\n    }\n    this.contentElement.appendChild(element);\n    this.elementInternal.classList.add('text-prompt');\n    ARIAUtils.markAsTextBox(this.elementInternal);\n    ARIAUtils.setAutocomplete(this.elementInternal, ARIAUtils.AutocompleteInteractionModel.both);\n    ARIAUtils.setHasPopup(this.elementInternal, ARIAUtils.PopupRole.ListBox);\n    this.elementInternal.setAttribute('contenteditable', 'plaintext-only');\n    this.element().addEventListener('keydown', this.boundOnKeyDown, false);\n    this.elementInternal.addEventListener('input', this.boundOnInput, false);\n    this.elementInternal.addEventListener('wheel', this.boundOnMouseWheel, false);\n    this.elementInternal.addEventListener('selectstart', this.boundClearAutocomplete, false);\n    this.elementInternal.addEventListener('blur', this.boundClearAutocomplete, false);\n\n    this.suggestBox = new SuggestBox(this, 20);\n\n    if (this.titleInternal) {\n      Tooltip.install(this.proxyElement, this.titleInternal);\n    }\n\n    return this.proxyElement;\n  }\n\n  element(): HTMLElement {\n    if (!this.elementInternal) {\n      throw new Error('Expected an already attached element!');\n    }\n    return this.elementInternal as HTMLElement;\n  }\n\n  detach(): void {\n    this.removeFromElement();\n    if (this.focusRestorer) {\n      this.focusRestorer.restore();\n    }\n    if (this.proxyElement && this.proxyElement.parentElement) {\n      this.proxyElement.parentElement.insertBefore(this.element(), this.proxyElement);\n      this.proxyElement.remove();\n    }\n    delete this.proxyElement;\n    this.element().classList.remove('text-prompt');\n    this.element().removeAttribute('contenteditable');\n    this.element().removeAttribute('role');\n    ARIAUtils.clearAutocomplete(this.element());\n    ARIAUtils.setHasPopup(this.element(), ARIAUtils.PopupRole.False);\n  }\n\n  textWithCurrentSuggestion(): string {\n    const text = this.text();\n    if (!this.queryRange || !this.currentSuggestion) {\n      return text;\n    }\n    const suggestion = this.currentSuggestion.text;\n    return text.substring(0, this.queryRange.startColumn) + suggestion + text.substring(this.queryRange.endColumn);\n  }\n\n  text(): string {\n    let text: string = this.element().textContent || '';\n    if (this.ghostTextElement.parentNode) {\n      const addition = this.ghostTextElement.textContent || '';\n      text = text.substring(0, text.length - addition.length);\n    }\n    return text;\n  }\n\n  setText(text: string): void {\n    this.clearAutocomplete();\n    this.element().textContent = text;\n    this.previousText = this.text();\n    if (this.element().hasFocus()) {\n      this.moveCaretToEndOfPrompt();\n      this.element().scrollIntoView();\n    }\n  }\n\n  setSelectedRange(startIndex: number, endIndex: number): void {\n    if (startIndex < 0) {\n      throw new RangeError('Selected range start must be a nonnegative integer');\n    }\n    const textContent = this.element().textContent;\n    const textContentLength = textContent ? textContent.length : 0;\n    if (endIndex > textContentLength) {\n      endIndex = textContentLength;\n    }\n    if (endIndex < startIndex) {\n      endIndex = startIndex;\n    }\n\n    const textNode = (this.element().childNodes[0] as Node);\n    const range = new Range();\n    range.setStart(textNode, startIndex);\n    range.setEnd(textNode, endIndex);\n    const selection = window.getSelection();\n    if (selection) {\n      selection.removeAllRanges();\n      selection.addRange(range);\n    }\n  }\n\n  focus(): void {\n    this.element().focus();\n  }\n\n  title(): string {\n    return this.titleInternal;\n  }\n\n  setTitle(title: string): void {\n    this.titleInternal = title;\n    if (this.proxyElement) {\n      Tooltip.install(this.proxyElement, title);\n    }\n  }\n\n  setPlaceholder(placeholder: string, ariaPlaceholder?: string): void {\n    if (placeholder) {\n      this.element().setAttribute('data-placeholder', placeholder);\n      // TODO(https://github.com/nvaccess/nvda/issues/10164): Remove ariaPlaceholder once the NVDA bug is fixed\n      // ariaPlaceholder and placeholder may differ, like in case the placeholder contains a '?'\n      ARIAUtils.setPlaceholder(this.element(), ariaPlaceholder || placeholder);\n    } else {\n      this.element().removeAttribute('data-placeholder');\n      ARIAUtils.setPlaceholder(this.element(), null);\n    }\n  }\n\n  setEnabled(enabled: boolean): void {\n    if (enabled) {\n      this.element().setAttribute('contenteditable', 'plaintext-only');\n    } else {\n      this.element().removeAttribute('contenteditable');\n    }\n    this.element().classList.toggle('disabled', !enabled);\n  }\n\n  private removeFromElement(): void {\n    this.clearAutocomplete();\n    this.element().removeEventListener(\n        'keydown', (this.boundOnKeyDown as (this: HTMLElement, arg1: Event) => void), false);\n    this.element().removeEventListener('input', (this.boundOnInput as (this: HTMLElement, arg1: Event) => void), false);\n    this.element().removeEventListener(\n        'selectstart', (this.boundClearAutocomplete as (this: HTMLElement, arg1: Event) => void), false);\n    this.element().removeEventListener(\n        'blur', (this.boundClearAutocomplete as (this: HTMLElement, arg1: Event) => void), false);\n    if (this.isEditing) {\n      this.stopEditing();\n    }\n    if (this.suggestBox) {\n      this.suggestBox.hide();\n    }\n  }\n\n  private startEditing(blurListener?: ((arg0: Event) => void)): void {\n    this.isEditing = true;\n    if (this.contentElement) {\n      this.contentElement.classList.add('text-prompt-editing');\n    }\n    this.focusRestorer = new ElementFocusRestorer(this.element());\n    if (blurListener) {\n      this.blurListener = blurListener;\n      this.element().addEventListener('blur', this.blurListener, false);\n    }\n    this.oldTabIndex = this.element().tabIndex;\n    if (this.element().tabIndex < 0) {\n      this.element().tabIndex = 0;\n    }\n    if (!this.text()) {\n      this.autoCompleteSoon();\n    }\n  }\n\n  private stopEditing(): void {\n    this.element().tabIndex = (this.oldTabIndex as number);\n    if (this.blurListener) {\n      this.element().removeEventListener('blur', this.blurListener, false);\n    }\n    if (this.contentElement) {\n      this.contentElement.classList.remove('text-prompt-editing');\n    }\n    delete this.isEditing;\n  }\n\n  onMouseWheel(_event: Event): void {\n    // Subclasses can implement.\n  }\n\n  onKeyDown(ev: Event): void {\n    let handled = false;\n    const event = (ev as KeyboardEvent);\n    if (this.isSuggestBoxVisible() && this.suggestBox && this.suggestBox.keyPressed(event)) {\n      event.consume(true);\n      return;\n    }\n\n    switch (event.key) {\n      case 'Tab':\n        handled = this.tabKeyPressed(event);\n        break;\n      case 'ArrowLeft':\n      case 'ArrowUp':\n      case 'PageUp':\n      case 'Home':\n        this.clearAutocomplete();\n        break;\n      case 'PageDown':\n      case 'ArrowRight':\n      case 'ArrowDown':\n      case 'End':\n        if (this.isCaretAtEndOfPrompt()) {\n          handled = this.acceptAutoComplete();\n        } else {\n          this.clearAutocomplete();\n        }\n        break;\n      case 'Escape':\n        if (this.isSuggestBoxVisible()) {\n          this.clearAutocomplete();\n          handled = true;\n        }\n        break;\n      case ' ':  // Space\n        if (event.ctrlKey && !event.metaKey && !event.altKey && !event.shiftKey) {\n          this.autoCompleteSoon(true);\n          handled = true;\n        }\n        break;\n    }\n\n    if (event.key === 'Enter') {\n      event.preventDefault();\n    }\n\n    if (handled) {\n      event.consume(true);\n    }\n  }\n\n  private acceptSuggestionOnStopCharacters(key: string): boolean {\n    if (!this.currentSuggestion || !this.queryRange || key.length !== 1 || !this.completionStopCharacters ||\n        !this.completionStopCharacters.includes(key)) {\n      return false;\n    }\n\n    const query = this.text().substring(this.queryRange.startColumn, this.queryRange.endColumn);\n    if (query && this.currentSuggestion.text.startsWith(query + key)) {\n      this.queryRange.endColumn += 1;\n      return this.acceptAutoComplete();\n    }\n    return false;\n  }\n\n  onInput(ev: Event): void {\n    const event = (ev as InputEvent);\n    let text = this.text();\n    const currentEntry = event.data;\n\n    if (event.inputType === 'insertFromPaste' && text.includes('\\n')) {\n      /* Ensure that we remove any linebreaks from copied/pasted content\n       * to avoid breaking the rendering of the filter bar.\n       * See crbug.com/849563.\n       * We don't let users enter linebreaks when\n       * typing manually, so we should escape them if copying text in.\n       */\n      text = Platform.StringUtilities.stripLineBreaks(text);\n      this.setText(text);\n    }\n\n    // Skip the current ')' entry if the caret is right before a ')' and there's an unmatched '('.\n    const caretPosition = this.getCaretPosition();\n    if (currentEntry === ')' && caretPosition >= 0 && this.leftParenthesesIndices.length > 0) {\n      const nextCharAtCaret = text[caretPosition];\n      if (nextCharAtCaret === ')' && this.tryMatchingLeftParenthesis(caretPosition)) {\n        text = text.substring(0, caretPosition) + text.substring(caretPosition + 1);\n        this.setText(text);\n        return;\n      }\n    }\n\n    if (currentEntry && !this.acceptSuggestionOnStopCharacters(currentEntry)) {\n      const hasCommonPrefix = text.startsWith(this.previousText) || this.previousText.startsWith(text);\n      if (this.queryRange && hasCommonPrefix) {\n        this.queryRange.endColumn += text.length - this.previousText.length;\n      }\n    }\n    this.refreshGhostText();\n    this.previousText = text;\n    this.dispatchEventToListeners(Events.TextChanged);\n\n    this.autoCompleteSoon();\n  }\n\n  acceptAutoComplete(): boolean {\n    let result = false;\n    if (this.isSuggestBoxVisible() && this.suggestBox) {\n      result = this.suggestBox.acceptSuggestion();\n    }\n    if (!result) {\n      result = this.acceptSuggestionInternal();\n    }\n    if (this.usesSuggestionBuilder && result) {\n      // Trigger autocompletions for text prompts using suggestion builders\n      this.autoCompleteSoon();\n    }\n    return result;\n  }\n\n  clearAutocomplete(): void {\n    const beforeText = this.textWithCurrentSuggestion();\n\n    if (this.isSuggestBoxVisible() && this.suggestBox) {\n      this.suggestBox.hide();\n    }\n    this.clearAutocompleteTimeout();\n    this.queryRange = null;\n    this.refreshGhostText();\n\n    if (beforeText !== this.textWithCurrentSuggestion()) {\n      this.dispatchEventToListeners(Events.TextChanged);\n    }\n  }\n\n  private refreshGhostText(): void {\n    if (this.currentSuggestion && this.currentSuggestion.hideGhostText) {\n      this.ghostTextElement.remove();\n      return;\n    }\n    if (this.queryRange && this.currentSuggestion && this.isCaretAtEndOfPrompt() &&\n        this.currentSuggestion.text.startsWith(this.text().substring(this.queryRange.startColumn))) {\n      this.ghostTextElement.textContent =\n          this.currentSuggestion.text.substring(this.queryRange.endColumn - this.queryRange.startColumn);\n      this.element().appendChild(this.ghostTextElement);\n    } else {\n      this.ghostTextElement.remove();\n    }\n  }\n\n  private clearAutocompleteTimeout(): void {\n    if (this.completeTimeout) {\n      clearTimeout(this.completeTimeout);\n      delete this.completeTimeout;\n    }\n    this.completionRequestId++;\n  }\n\n  autoCompleteSoon(force?: boolean): void {\n    const immediately = this.isSuggestBoxVisible() || force;\n    if (!this.completeTimeout) {\n      this.completeTimeout =\n          window.setTimeout(this.complete.bind(this, force), immediately ? 0 : this.autocompletionTimeout);\n    }\n  }\n\n  async complete(force?: boolean): Promise<void> {\n    this.clearAutocompleteTimeout();\n    const selection = this.element().getComponentSelection();\n    if (!selection || selection.rangeCount === 0) {\n      return;\n    }\n    const selectionRange = selection.getRangeAt(0);\n\n    let shouldExit;\n\n    if (!force && !this.isCaretAtEndOfPrompt() && !this.isSuggestBoxVisible()) {\n      shouldExit = true;\n    } else if (!selection.isCollapsed) {\n      shouldExit = true;\n    }\n\n    if (shouldExit) {\n      this.clearAutocomplete();\n      return;\n    }\n\n    const wordQueryRange = DOMExtension.DOMExtension.rangeOfWord(\n        selectionRange.startContainer, selectionRange.startOffset, this.completionStopCharacters, this.element(),\n        'backward');\n\n    const expressionRange = wordQueryRange.cloneRange();\n    expressionRange.collapse(true);\n    expressionRange.setStartBefore(this.element());\n    const completionRequestId = ++this.completionRequestId;\n    const completions =\n        await this.loadCompletions.call(null, expressionRange.toString(), wordQueryRange.toString(), Boolean(force));\n    this.completionsReady(completionRequestId, (selection as Selection), wordQueryRange, Boolean(force), completions);\n  }\n\n  disableDefaultSuggestionForEmptyInput(): void {\n    this.disableDefaultSuggestionForEmptyInputInternal = true;\n  }\n\n  private boxForAnchorAtStart(selection: Selection, textRange: Range): AnchorBox {\n    const rangeCopy = selection.getRangeAt(0).cloneRange();\n    const anchorElement = document.createElement('span');\n    anchorElement.textContent = '\\u200B';\n    textRange.insertNode(anchorElement);\n    const box = anchorElement.boxInWindow(window);\n    anchorElement.remove();\n    selection.removeAllRanges();\n    selection.addRange(rangeCopy);\n    return box;\n  }\n\n  additionalCompletions(_query: string): Suggestion[] {\n    return [];\n  }\n\n  private completionsReady(\n      completionRequestId: number, selection: Selection, originalWordQueryRange: Range, force: boolean,\n      completions: Suggestion[]): void {\n    if (this.completionRequestId !== completionRequestId) {\n      return;\n    }\n\n    const query = originalWordQueryRange.toString();\n\n    // Filter out dupes.\n    const store = new Set<string>();\n    completions = completions.filter(item => !store.has(item.text) && Boolean(store.add(item.text)));\n\n    if (query || force) {\n      if (query) {\n        completions = completions.concat(this.additionalCompletions(query));\n      } else {\n        completions = this.additionalCompletions(query).concat(completions);\n      }\n    }\n\n    if (!completions.length) {\n      this.clearAutocomplete();\n      return;\n    }\n\n    const selectionRange = selection.getRangeAt(0);\n\n    const fullWordRange = document.createRange();\n    fullWordRange.setStart(originalWordQueryRange.startContainer, originalWordQueryRange.startOffset);\n    fullWordRange.setEnd(selectionRange.endContainer, selectionRange.endOffset);\n\n    if (query + selectionRange.toString() !== fullWordRange.toString()) {\n      return;\n    }\n\n    const beforeRange = document.createRange();\n    beforeRange.setStart(this.element(), 0);\n    beforeRange.setEnd(fullWordRange.startContainer, fullWordRange.startOffset);\n    this.queryRange = new TextUtils.TextRange.TextRange(\n        0, beforeRange.toString().length, 0, beforeRange.toString().length + fullWordRange.toString().length);\n\n    const shouldSelect = !this.disableDefaultSuggestionForEmptyInputInternal || Boolean(this.text());\n    if (this.suggestBox) {\n      this.suggestBox.updateSuggestions(\n          this.boxForAnchorAtStart(selection, fullWordRange), completions, shouldSelect, !this.isCaretAtEndOfPrompt(),\n          this.text());\n    }\n  }\n\n  applySuggestion(suggestion: Suggestion|null, isIntermediateSuggestion?: boolean): void {\n    this.currentSuggestion = suggestion;\n    this.refreshGhostText();\n    if (isIntermediateSuggestion) {\n      this.dispatchEventToListeners(Events.TextChanged);\n    }\n  }\n\n  acceptSuggestion(): void {\n    this.acceptSuggestionInternal();\n  }\n\n  private acceptSuggestionInternal(): boolean {\n    if (!this.queryRange) {\n      return false;\n    }\n\n    const suggestionLength = this.currentSuggestion ? this.currentSuggestion.text.length : 0;\n    const selectionRange = this.currentSuggestion ? this.currentSuggestion.selectionRange : null;\n    const endColumn = selectionRange ? selectionRange.endColumn : suggestionLength;\n    const startColumn = selectionRange ? selectionRange.startColumn : suggestionLength;\n    this.element().textContent = this.textWithCurrentSuggestion();\n    this.setDOMSelection(this.queryRange.startColumn + startColumn, this.queryRange.startColumn + endColumn);\n    this.updateLeftParenthesesIndices();\n\n    this.clearAutocomplete();\n    this.dispatchEventToListeners(Events.TextChanged);\n\n    return true;\n  }\n\n  ariaControlledBy(): Element {\n    return this.element();\n  }\n\n  setDOMSelection(startColumn: number, endColumn: number): void {\n    this.element().normalize();\n    const node = this.element().childNodes[0];\n    if (!node || node === this.ghostTextElement) {\n      return;\n    }\n    const range = document.createRange();\n    range.setStart(node, startColumn);\n    range.setEnd(node, endColumn);\n    const selection = this.element().getComponentSelection();\n    if (selection) {\n      selection.removeAllRanges();\n      selection.addRange(range);\n    }\n  }\n\n  isSuggestBoxVisible(): boolean {\n    return this.suggestBox !== undefined && this.suggestBox.visible();\n  }\n\n  isCaretInsidePrompt(): boolean {\n    const selection = this.element().getComponentSelection();\n    if (!selection || selection.rangeCount === 0 || !selection.isCollapsed) {\n      return false;\n    }\n    // @see crbug.com/602541\n    const selectionRange = selection.getRangeAt(0);\n    return selectionRange.startContainer.isSelfOrDescendant(this.element());\n  }\n\n  private isCaretAtEndOfPrompt(): boolean {\n    const selection = this.element().getComponentSelection();\n    if (!selection || selection.rangeCount === 0 || !selection.isCollapsed) {\n      return false;\n    }\n\n    const selectionRange = selection.getRangeAt(0);\n    let node: (Node|null)|Node = selectionRange.startContainer;\n    if (!node.isSelfOrDescendant(this.element())) {\n      return false;\n    }\n\n    if (this.ghostTextElement.isAncestor(node)) {\n      return true;\n    }\n\n    if (node.nodeType === Node.TEXT_NODE && selectionRange.startOffset < (node.nodeValue || '').length) {\n      return false;\n    }\n\n    let foundNextText = false;\n    while (node) {\n      if (node.nodeType === Node.TEXT_NODE && node.nodeValue && node.nodeValue.length) {\n        if (foundNextText && !this.ghostTextElement.isAncestor(node)) {\n          return false;\n        }\n        foundNextText = true;\n      }\n\n      node = node.traverseNextNode(this.elementInternal);\n    }\n\n    return true;\n  }\n\n  moveCaretToEndOfPrompt(): void {\n    const selection = this.element().getComponentSelection();\n    const selectionRange = document.createRange();\n\n    let container: Node = this.element();\n    while (container.lastChild) {\n      container = container.lastChild;\n    }\n    let offset = 0;\n    if (container.nodeType === Node.TEXT_NODE) {\n      const textNode = (container as Text);\n      offset = (textNode.textContent || '').length;\n    }\n    selectionRange.setStart(container, offset);\n    selectionRange.setEnd(container, offset);\n\n    if (selection) {\n      selection.removeAllRanges();\n      selection.addRange(selectionRange);\n    }\n  }\n\n  /** -1 if no caret can be found in text prompt\n     */\n  private getCaretPosition(): number {\n    if (!this.element().hasFocus()) {\n      return -1;\n    }\n\n    const selection = this.element().getComponentSelection();\n    if (!selection || selection.rangeCount === 0 || !selection.isCollapsed) {\n      return -1;\n    }\n    const selectionRange = selection.getRangeAt(0);\n    if (selectionRange.startOffset !== selectionRange.endOffset) {\n      return -1;\n    }\n    return selectionRange.startOffset;\n  }\n\n  tabKeyPressed(_event: Event): boolean {\n    return this.acceptAutoComplete();\n  }\n\n  proxyElementForTests(): Element|null {\n    return this.proxyElement || null;\n  }\n\n  /**\n   * Try matching the most recent open parenthesis with the given right\n   * parenthesis, and closes the matched left parenthesis if found.\n   * Return the result of the matching.\n   */\n  private tryMatchingLeftParenthesis(rightParenthesisIndex: number): boolean {\n    const leftParenthesesIndices = this.leftParenthesesIndices;\n    if (leftParenthesesIndices.length === 0 || rightParenthesisIndex < 0) {\n      return false;\n    }\n\n    for (let i = leftParenthesesIndices.length - 1; i >= 0; --i) {\n      if (leftParenthesesIndices[i] < rightParenthesisIndex) {\n        leftParenthesesIndices.splice(i, 1);\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  private updateLeftParenthesesIndices(): void {\n    const text = this.text();\n    const leftParenthesesIndices: number[] = this.leftParenthesesIndices = [];\n    for (let i = 0; i < text.length; ++i) {\n      if (text[i] === '(') {\n        leftParenthesesIndices.push(i);\n      }\n    }\n  }\n}\n\nconst DefaultAutocompletionTimeout = 250;\n\n// TODO(crbug.com/1167717): Make this a const enum again\n// eslint-disable-next-line rulesdir/const_enum\nexport enum Events {\n  TextChanged = 'TextChanged',\n}\n\nexport type EventTypes = {\n  [Events.TextChanged]: void,\n};\n"]}