{"version":3,"file":"XWidget.js","sourceRoot":"","sources":["../../../../../../front_end/ui/legacy/XWidget.ts"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,KAAK,gBAAgB,MAAM,kCAAkC,CAAC;AAErE,OAAO,EAAC,QAAQ,EAAC,MAAM,eAAe,CAAC;AAEvC,IAAI,QAAQ,GAAwB,IAAI,CAAC;AAEzC,MAAM,qBAAqB,GAAG,IAAI,OAAO,EAGrC,CAAC;AAEL,MAAM,OAAO,OAAQ,SAAQ,QAAQ;IAC3B,OAAO,CAAU;IACR,kBAAkB,CAAyB;IACpD,qBAAqB,CAAe;IACpC,mCAAmC,CAAY;IAC/C,eAAe,CAAqB;IACpC,gBAAgB,CAAqB;IACrC,iBAAiB,CAAqB;IAE9C;QACE,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;QAC1C,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,gBAAgB,EAAE,QAAQ,CAAC,CAAC;QACnD,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,aAAa,EAAE,SAAS,CAAC,CAAC;QACjD,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,iBAAiB,EAAE,YAAY,CAAC,CAAC;QACxD,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,SAAS,EAAE,cAAc,CAAC,CAAC;QAElD,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;QACrB,IAAI,CAAC,qBAAqB,GAAG,IAAI,CAAC;QAClC,IAAI,CAAC,mCAAmC,GAAG,EAAE,CAAC;QAE9C,IAAI,CAAC,QAAQ,EAAE;YACb,QAAQ,GAAG,IAAI,cAAc,CAAC,OAAO,CAAC,EAAE;gBACtC,KAAK,MAAM,KAAK,IAAI,OAAO,EAAE;oBAC3B,MAAM,MAAM,GAAI,KAAK,CAAC,MAAkB,CAAC;oBACzC,IAAI,MAAM,CAAC,OAAO,IAAI,MAAM,CAAC,iBAAiB,EAAE;wBAC9C,MAAM,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;qBACrC;iBACF;YACH,CAAC,CAAC,CAAC;SACJ;QAED,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;QAEvB,IAAI,CAAC,sCAAsC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;IACtD,CAAC;IAED,SAAS;QACP,OAAO,IAAI,CAAC,OAAO,CAAC;IACtB,CAAC;IAED,UAAU,CAAC,QAA2B;QACpC,IAAI,CAAC,eAAe,GAAG,QAAQ,CAAC;IAClC,CAAC;IAED,WAAW,CAAC,QAA2B;QACrC,IAAI,CAAC,gBAAgB,GAAG,QAAQ,CAAC;IACnC,CAAC;IAED,YAAY,CAAC,QAA2B;QACtC,IAAI,CAAC,iBAAiB,GAAG,QAAQ,CAAC;IACpC,CAAC;IAED,sCAAsC,CAAC,QAAmB;QACxD,KAAK,MAAM,OAAO,IAAI,IAAI,CAAC,mCAAmC,EAAE;YAC9D,OAAO,CAAC,mBAAmB,CAAC,QAAQ,EAAE,OAAO,CAAC,mBAAmB,EAAE,EAAC,OAAO,EAAE,KAAK,EAAC,CAAC,CAAC;SACtF;QACD,IAAI,CAAC,mCAAmC,GAAG,QAAQ,CAAC;QACpD,KAAK,MAAM,OAAO,IAAI,IAAI,CAAC,mCAAmC,EAAE;YAC9D,OAAO,CAAC,gBAAgB,CAAC,QAAQ,EAAE,OAAO,CAAC,mBAAmB,EAAE,EAAC,OAAO,EAAE,IAAI,EAAE,OAAO,EAAE,KAAK,EAAC,CAAC,CAAC;SAClG;IACH,CAAC;IAED,sBAAsB;QACpB,KAAK,MAAM,OAAO,IAAI,IAAI,CAAC,mCAAmC,EAAE;YAC9D,MAAM,eAAe,GAAG,qBAAqB,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;YAC3D,IAAI,eAAe,EAAE;gBACnB,OAAO,CAAC,SAAS,GAAG,eAAe,CAAC,SAAS,CAAC;gBAC9C,OAAO,CAAC,UAAU,GAAG,eAAe,CAAC,UAAU,CAAC;aACjD;SACF;IACH,CAAC;IAEO,MAAM,CAAC,mBAAmB,CAAC,KAAY;QAC7C,MAAM,OAAO,GAAI,KAAK,CAAC,aAAyB,CAAC;QACjD,qBAAqB,CAAC,GAAG,CAAC,OAAO,EAAE,EAAC,UAAU,EAAE,OAAO,CAAC,UAAU,EAAE,SAAS,EAAE,OAAO,CAAC,SAAS,EAAC,CAAC,CAAC;IACrG,CAAC;IAED,wBAAwB,CAAC,OAAqB;QAC5C,IAAI,OAAO,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,EAAE;YAC9C,MAAM,IAAI,KAAK,CAAC,kCAAkC,CAAC,CAAC;SACrD;QACD,IAAI,CAAC,qBAAqB,GAAG,OAAO,CAAC;IACvC,CAAC;IAED,KAAK;QACH,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;YACjB,OAAO;SACR;QAED,IAAI,OAAO,CAAC;QACZ,IAAI,IAAI,CAAC,qBAAqB,IAAI,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,qBAAqB,CAAC,EAAE;YACnF,OAAO,GAAG,IAAI,CAAC,qBAAqB,CAAC;SACtC;aAAM,IAAI,IAAI,CAAC,QAAQ,KAAK,CAAC,CAAC,EAAE;YAC/B,OAAO,GAAG,IAAI,CAAC;SAChB;aAAM;YACL,IAAI,KAAK,GAAG,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;YACxC,OAAO,KAAK,EAAE;gBACZ,IAAI,CAAC,KAAK,YAAY,OAAO,CAAC,IAAI,KAAK,CAAC,OAAO,EAAE;oBAC/C,OAAO,GAAG,KAAK,CAAC;oBAChB,MAAM;iBACP;gBACD,KAAK,GAAG,KAAK,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;aACtC;SACF;QAED,IAAI,CAAC,OAAO,IAAI,OAAO,CAAC,QAAQ,EAAE,EAAE;YAClC,OAAO;SACR;QACD,IAAI,OAAO,KAAK,IAAI,EAAE;YACpB,WAAW,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SACxC;aAAM;YACJ,OAAuB,CAAC,KAAK,EAAE,CAAC;SAClC;IACH,CAAC;IAED,iBAAiB;QACf,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QACpB,IAAI,CAAC,sBAAsB,EAAE,CAAC;QAC9B,IAAI,IAAI,CAAC,eAAe,EAAE;YACxB,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SACjC;IACH,CAAC;IAED,oBAAoB;QAClB,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;QACrB,IAAI,IAAI,CAAC,gBAAgB,EAAE;YACzB,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SAClC;IACH,CAAC;CACF;AAED,gBAAgB,CAAC,cAAc,CAAC,eAAe,CAAC,UAAU,EAAE,OAAO,CAAC,CAAC","sourcesContent":["// Copyright 2017 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as ComponentHelpers from '../components/helpers/helpers.js';\n\nimport {XElement} from './XElement.js';\n\nlet observer: ResizeObserver|null = null;\n\nconst storedScrollPositions = new WeakMap<Element, {\n  scrollLeft: number,\n  scrollTop: number,\n}>();\n\nexport class XWidget extends XElement {\n  private visible: boolean;\n  private readonly shadowRootInternal!: DocumentFragment|null;\n  private defaultFocusedElement: Element|null;\n  private elementsToRestoreScrollPositionsFor: Element[];\n  private onShownCallback!: (() => void)|null;\n  private onHiddenCallback!: (() => void)|null;\n  private onResizedCallback!: (() => void)|null;\n\n  constructor() {\n    super();\n    this.style.setProperty('display', 'flex');\n    this.style.setProperty('flex-direction', 'column');\n    this.style.setProperty('align-items', 'stretch');\n    this.style.setProperty('justify-content', 'flex-start');\n    this.style.setProperty('contain', 'layout style');\n\n    this.visible = false;\n    this.defaultFocusedElement = null;\n    this.elementsToRestoreScrollPositionsFor = [];\n\n    if (!observer) {\n      observer = new ResizeObserver(entries => {\n        for (const entry of entries) {\n          const widget = (entry.target as XWidget);\n          if (widget.visible && widget.onResizedCallback) {\n            widget.onResizedCallback.call(null);\n          }\n        }\n      });\n    }\n\n    observer.observe(this);\n\n    this.setElementsToRestoreScrollPositionsFor([this]);\n  }\n\n  isShowing(): boolean {\n    return this.visible;\n  }\n\n  setOnShown(callback: (() => void)|null): void {\n    this.onShownCallback = callback;\n  }\n\n  setOnHidden(callback: (() => void)|null): void {\n    this.onHiddenCallback = callback;\n  }\n\n  setOnResized(callback: (() => void)|null): void {\n    this.onResizedCallback = callback;\n  }\n\n  setElementsToRestoreScrollPositionsFor(elements: Element[]): void {\n    for (const element of this.elementsToRestoreScrollPositionsFor) {\n      element.removeEventListener('scroll', XWidget.storeScrollPosition, {capture: false});\n    }\n    this.elementsToRestoreScrollPositionsFor = elements;\n    for (const element of this.elementsToRestoreScrollPositionsFor) {\n      element.addEventListener('scroll', XWidget.storeScrollPosition, {passive: true, capture: false});\n    }\n  }\n\n  restoreScrollPositions(): void {\n    for (const element of this.elementsToRestoreScrollPositionsFor) {\n      const storedPositions = storedScrollPositions.get(element);\n      if (storedPositions) {\n        element.scrollTop = storedPositions.scrollTop;\n        element.scrollLeft = storedPositions.scrollLeft;\n      }\n    }\n  }\n\n  private static storeScrollPosition(event: Event): void {\n    const element = (event.currentTarget as Element);\n    storedScrollPositions.set(element, {scrollLeft: element.scrollLeft, scrollTop: element.scrollTop});\n  }\n\n  setDefaultFocusedElement(element: Element|null): void {\n    if (element && !this.isSelfOrAncestor(element)) {\n      throw new Error('Default focus must be descendant');\n    }\n    this.defaultFocusedElement = element;\n  }\n\n  focus(): void {\n    if (!this.visible) {\n      return;\n    }\n\n    let element;\n    if (this.defaultFocusedElement && this.isSelfOrAncestor(this.defaultFocusedElement)) {\n      element = this.defaultFocusedElement;\n    } else if (this.tabIndex !== -1) {\n      element = this;\n    } else {\n      let child = this.traverseNextNode(this);\n      while (child) {\n        if ((child instanceof XWidget) && child.visible) {\n          element = child;\n          break;\n        }\n        child = child.traverseNextNode(this);\n      }\n    }\n\n    if (!element || element.hasFocus()) {\n      return;\n    }\n    if (element === this) {\n      HTMLElement.prototype.focus.call(this);\n    } else {\n      (element as HTMLElement).focus();\n    }\n  }\n\n  connectedCallback(): void {\n    this.visible = true;\n    this.restoreScrollPositions();\n    if (this.onShownCallback) {\n      this.onShownCallback.call(null);\n    }\n  }\n\n  disconnectedCallback(): void {\n    this.visible = false;\n    if (this.onHiddenCallback) {\n      this.onHiddenCallback.call(null);\n    }\n  }\n}\n\nComponentHelpers.CustomElements.defineComponent('x-widget', XWidget);\n"]}