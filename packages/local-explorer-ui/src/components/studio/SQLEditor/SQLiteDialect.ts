import { SQLDialect } from "@codemirror/lang-sql";

// Complete list of built-in SQLite functions sourced from the official documentation:
// - https://www.sqlite.org/lang_corefunc.html
// - https://www.sqlite.org/lang_datefunc.html
// - https://www.sqlite.org/lang_aggfunc.html
// - https://www.sqlite.org/lang_mathfunc.html
// - https://www.sqlite.org/json1.html
//
// Includes scalar functions, aggregate functions, date/time functions, math functions, and JSON1 extension functions.
export const sqliteBuiltinFunctionList = [
	// Core scalar functions
	"abs",
	"changes",
	"char",
	"coalesce",
	"glob",
	"hex",
	"ifnull",
	"iif",
	"instr",
	"last_insert_rowid",
	"length",
	"like",
	"likelihood",
	"likely",
	"load_extension",
	"lower",
	"ltrim",
	"max",
	"min",
	"random",
	"randomblob",
	"replace",
	"round",
	"rtrim",
	"soundex",
	"sqlite_compileoption_get",
	"sqlite_compileoption_used",
	"sqlite_source_id",
	"sqlite_version",
	"substr",
	"substring",
	"total_changes",
	"trim",
	"typeof",
	"unicode",
	"unhex",
	"unistr",
	"unistr_quote",
	"unlikely",
	"upper",
	"zeroblob",

	// Date & time functions
	"date",
	"time",
	"datetime",
	"julianday",
	"unixepoch",
	"strftime",
	"timediff",

	// Aggregate functions
	"avg",
	"count",
	"group_concat",
	"max",
	"min",
	"sum",
	"total",
	"count",

	// Math functions
	"acos",
	"asin",
	"atan",
	"atan2",
	"ceil",
	"ceiling",
	"cos",
	"cosh",
	"degrees",
	"exp",
	"floor",
	"ln",
	"log",
	"log10",
	"mod",
	"pi",
	"pow",
	"power",
	"radians",
	"rand",
	"sign",
	"sin",
	"sinh",
	"sqrt",
	"tan",
	"tanh",
	"trunc",

	// JSON1 extension functions
	"json",
	"json_array_length",
	"json_extract",
	"json_insert",
	"json_remove",
	"json_set",
	"json_replace",
	"json_type",
	"json_valid",
	"json_patch",
	"json_quote",
];

const sqliteKeywords = [
	"ABORT",
	"ADD",
	"AFTER",
	"ALL",
	"ALTER",
	"ALWAYS",
	"ANALYZE",
	"AND",
	"AS",
	"ASC",
	"ATTACH",
	"AUTOINCREMENT",
	"BEFORE",
	"BEGIN",
	"BETWEEN",
	"BY",
	"CASCADE",
	"CASE",
	"CAST",
	"CHECK",
	"COLLATE",
	"COLUMN",
	"COMMIT",
	"CONFLICT",
	"CONSTRAINT",
	"CREATE",
	"CROSS",
	"CURRENT_DATE",
	"CURRENT_TIME",
	"CURRENT_TIMESTAMP",
	"DATABASE",
	"DEFAULT",
	"DEFERRED",
	"DEFERRABLE",
	"DELETE",
	"DESC",
	"DETACH",
	"DISTINCT",
	"DROP",
	"EACH",
	"ELSE",
	"ESCAPE",
	"EXCEPT",
	"EXCLUSIVE",
	"EXISTS",
	"EXPLAIN",
	"FAIL",
	"FOR",
	"FOREIGN",
	"FROM",
	"FULL",
	"GENERATED",
	"GLOB",
	"GROUP",
	"HAVING",
	"IF",
	"IGNORE",
	"IMMEDIATE",
	"IN",
	"INDEX",
	"INITIALLY",
	"INNER",
	"INSERT",
	"INSTEAD",
	"INTERSECT",
	"INTO",
	"IS",
	"ISNULL",
	"JOIN",
	"KEY",
	"LEFT",
	"LIKE",
	"LIMIT",
	"MATCH",
	"NATURAL",
	"NOT",
	"NOTNULL",
	"NULL",
	"OF",
	"OFFSET",
	"ON",
	"OR",
	"ORDER",
	"OUTER",
	"PLAN",
	"PRAGMA",
	"PRIMARY",
	"QUERY",
	"RAISE",
	"REFERENCES",
	"REGEXP",
	"REINDEX",
	"RENAME",
	"REPLACE",
	"RESTRICT",
	"RIGHT",
	"ROLLBACK",
	"ROW",
	"SELECT",
	"SET",
	"TABLE",
	"TEMP",
	"TEMPORARY",
	"THEN",
	"TO",
	"TRANSACTION",
	"TRIGGER",
	"UNION",
	"UNIQUE",
	"UPDATE",
	"USING",
	"VACUUM",
	"VALUES",
	"VIEW",
	"VIRTUAL",
	"WHEN",
	"WHERE",
];

const sqliteDataTypes = [
	// Integer affinity
	"INT",
	"INTEGER",
	"TINYINT",
	"SMALLINT",
	"MEDIUMINT",
	"BIGINT",
	"UNSIGNED BIG INT",
	"INT2",
	"INT8",

	// Text affinity
	"CHARACTER",
	"VARCHAR",
	"VARYING CHARACTER",
	"NCHAR",
	"NATIVE CHARACTER",
	"NVARCHAR",
	"TEXT",
	"CLOB",

	// Real affinity
	"REAL",
	"DOUBLE",
	"DOUBLE PRECISION",
	"FLOAT",

	// Numeric affinity
	"NUMERIC",
	"DECIMAL",
	"BOOLEAN",
	"DATE",
	"DATETIME",

	// Blob affinity
	"BLOB",
];

// https://github.com/codemirror/lang-sql/blob/87e090931a20b67194ae6bf59d374b9afc8a7447/src/sql.ts#L324
// Based on this definition except we are swapping our own keyword and built-in functions
export const StudioSQLiteDialect = SQLDialect.define({
	keywords: [
		...sqliteKeywords,
		...sqliteBuiltinFunctionList,
		...sqliteDataTypes,
	]
		.join(" ")
		.toLowerCase(),
	builtin: "",
	types: "",
	operatorChars: "*/+-%<>!=~",
	doubleQuotedStrings: true,
	charSetCasts: false,
});
